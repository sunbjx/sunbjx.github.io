<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æˆ‘è®©è‡ªå·±è‡ªç”±äº†ä¸‰å¹´]]></title>
    <url>%2F2017%2F09%2F18%2F%E6%88%91%E8%AE%A9%E8%87%AA%E5%B7%B1%E8%87%AA%E7%94%B1%E4%BA%86%E4%B8%89%E5%B9%B4%2F</url>
    <content type="text"><![CDATA[æˆ‘è®©è‡ªå·±è‡ªç”±äº†ä¸‰å¹´-è¿Ÿæ¥çš„äººç”Ÿè§„åˆ’ï¼ˆæœªæ¥çš„3å¹´è®¡åˆ’5å¹´è§„åˆ’ï¼‰ æ„Ÿè§‰è¿™ä¸€åˆ»æ‰åˆšå¼€å§‹ï¼ˆæ¯•ä¸šåŽçš„é¢è¯•ä¸­æ€»ä¼šé‡åˆ°ä½ æœªæ¥çš„äº”å¹´è§„åˆ’æˆ–è€…è®¡åˆ’æ˜¯ä»€ä¹ˆï¼Ÿæ”¯æ”¯å¾å¾äº†ä¸‹-ðŸ˜… æŽ¥ç€é—®åˆ°ä½ æœªæ¥ä¸‰å¹´æ˜¯ä»€ä¹ˆæˆ–è€…æŽ¥ä¸‹æ¥ä¸€å¹´æ˜¯ä»€ä¹ˆï¼ŸæŽ¥ç€ðŸ˜…ï¼‰ å°±è¿™æ ·å°´å°¬äº†ä¸‰å¹´ï¼ˆå·¥ä½œä¸Šä¸€ç›´åœ¨è¢«åŠ¨å·¥ä½œï¼Œå­¦ä¹ ä¸Šå‡ ä¹Žæ²¡æœ‰ï¼Œæœ€åŽç»åŽ†äº†ç”±æ‹çˆ±åˆ°å¯‚å¯žä¸Žå­¤ç‹¬ï¼‰ 2018-2020å¹´ æˆ‘çš„äººç”Ÿç¬¬ä¸€ä¸ªä¸‰å¹´è®¡åˆ’2021-2025å¹´ æˆ‘çš„äººç”Ÿç¬¬ä¸€ä¸ªäº”å¹´è§„åˆ’2018-2020å¹´ æˆ‘è¦åœ¨æˆéƒ½åœ¨è‹±å­šæŠŠæˆ‘çš„è‹±è¯­åŸ¹è®­èµ·æ¥ï¼ˆè‡³å°‘è¦å…»æˆä¸€ä¸ªæ¯å¤©å­¦è‹±è¯­çš„å¥½ä¹ æƒ¯ï¼‰ï¼›å·¥ä½œä¸Šæˆ‘å¿…é¡»åœ¨devopsè¿™ä¸€å—ä¸æ–­çš„å¤¯å®žè‡ªå·± åŠ å€æ—¶é—´åŽ»å®Œæˆï¼ˆä¸»æ‰“java æ¶‰åŠpython go jsï¼‰ï¼›ç”Ÿæ´»é‡Œèƒ½å¦æ‰¾åˆ°è‡ªå·±å¿ƒä»ªçš„é€‚åˆç»“å©šçš„å¥½å¥³å­©ðŸ˜Šï¼›åœ¨çˆ¶æ¯çš„å¸®åŠ©ä¸‹å¿…é¡»ä¸€å®šå¾—è‡ªå·±åŽ»åœ¨æˆéƒ½æŒ‰æ­ä¸€å¥—å¿ƒä»ªçš„æˆ¿å­ï¼›è½¦èƒ½ä¸ä¹°å°±ä¸ä¹° ä¹°äº†ä¹Ÿæ˜¯åƒç°ðŸ˜‚ðŸ¤¦â€â™‚ï¸2021-2025å¹´ åœ¨ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„å…¬å¸æŠŠå®ƒå½“æˆè‡ªå·±çš„å…¬å¸å°½æˆ‘æ‰€èƒ½çœ‹çœ‹æˆ‘èƒ½ä¸ºå…¬å¸åˆ›é€ å¤šå¤§çš„æ•ˆç›Šå¹¶ä¸”å¯¹æ¯”ä¸€ä¸‹å…¬å¸ä¸ºæˆ‘çš„èŠ±è´¹ï¼ˆå…¬å¸åœ°å€ä¸å±€é™äºŽå›½å†…ðŸ˜„ðŸ’ªï¼‰ è¿™æ—¶å€™è‡ªå·±35å²äº†å¿…é¡»å¾—æœ‰ä¸€ä¸ªå¹¸ç¦çš„å®¶åº­ï¼ˆåœ¨æ­¤ä¹‹å‰èƒ½å¤Ÿå…¼é¡¾åˆ°å¹¶å®Œæˆå½“ç„¶æ›´å¥½ðŸ˜‚ðŸ’ªï¼‰ï¼›é€‰æ‹©ä¸Žèƒ½å¤Ÿéžå¸¸éžå¸¸éžå¸¸ä¿¡ä»»çš„æœ‹å‹å¤§å®¶ä¸€æ¡å¿ƒçš„åŽ»åˆ›ä¸šï¼ˆäº§å“æ–¹å‘èƒ½å¤Ÿä¸ºç¤¾ä¼šä¸ºäººä»¬å¸¦æ¥ä¾¿åˆ©ä¸Žå¥½å¤„ï¼‰or èƒ½é‡åˆ°ä¸€ä¸ªç†æƒ³çš„å¥½å¹³å°è¾¾åˆ°å’Œè‡ªå·±åˆ›ä¸šä¸€è‡´çš„èƒ½å¤Ÿé«˜é€Ÿé«˜è´¨é‡ç¨³å®šçš„é©¶å‘è¿œæ–¹ è®©è‡ªå·±å¯¹è¿™ä¸ªä¸–ç•Œç”šè‡³è¿™èŒ«èŒ«æ˜Ÿäº‘ä¸­äº†è§£çš„æ›´å¤šæŽ¢ç´¢çš„æ›´å¤š è¿™ä¸€åˆ‡éƒ½å¿…é¡»å¾—èº«ä½“å¥åº·â›½ï¸ å¤§å”é˜¶æ®µèƒ½æŠŠå¦¹ï¼ŒèŠ±ç”²ä¹‹å¹´èƒ½æŠ±å­™å­å­™å¥³ï¼Œæœ‰ç”Ÿä¹‹å¹´èƒ½è§é‡å­™é‡å­™å¥³ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â€”ç¨‹åºå‘˜ä¹Ÿæœ‰çš„å¹¸ç¦]]></content>
      <categories>
        <category>è§„åˆ’ä¸Žè®¡åˆ’</category>
        <category>äººç”Ÿè§„åˆ’</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨CentOS7ä¸Šéƒ¨ç½²kubernetes1.7 HA é›†ç¾¤(Vagrant)]]></title>
    <url>%2F2017%2F09%2F13%2F%E5%9C%A8CentOS7%E4%B8%8A%E9%83%A8%E7%BD%B2kubernetes1-7-HA-%E9%9B%86%E7%BE%A4-Vagrant%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨virtualbox + vagrantå®‰è£…centos7vagrantå‡†æœ¬å·¥ä½œ1ã€å…·ä½“å®‰è£…å’Œä½¿ç”¨virtualbox &amp;&amp; vagrantè¯·è‡ªè¡ŒGoogle 2ã€æœç´¢centos7 box:https://app.vagrantup.com/boxes/search?provider=virtualbox 3ã€ç”ŸæˆVagrantfile 123mkdir -p ~/Vagrant/k8s-clustercd ~/Vagrant/k8s-clustervagrant init centos/7 å®‰è£…centos71ã€ç¼–è¾‘Vagrantfile 123cd ~/Vagrant/k8s-clustercp Vagrantfile ./Vagrantfile_backupemacs Vagrantfile Vagrantfile å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# coding: utf-8Vagrant.configure(&quot;2&quot;) do |config| (11..13).each do |i| config.vm.define &quot;k8s-master#&#123;i&#125;&quot; do |node| # è®¾ç½®è™šæ‹Ÿæœºçš„Box node.vm.box = &quot;centos/7&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå node.vm.hostname=&quot;master#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„IP node.vm.network &quot;public_network&quot;, ip: &quot;192.168.7.#&#123;i&#125;&quot;, :bridge=&gt;&apos;en0: Wi-Fi (AirPort)&apos; node.vm.boot_timeout = 20 # è®¾ç½®ä¸»æœºä¸Žè™šæ‹Ÿæœºçš„å…±äº«ç›®å½• node.vm.synced_folder &quot;/Users/sunbjx/Vagrant/share&quot;, &quot;/home/vagrant/share&quot; # VirtaulBoxç›¸å…³é…ç½® node.vm.provider &quot;virtualbox&quot; do |v| # è®¾ç½®è™šæ‹Ÿæœºçš„åç§° v.name = &quot;k8s-master#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å° v.memory = 4096 # è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•° v.cpus = 2 end # ä½¿ç”¨shellè„šæœ¬è¿›è¡Œè½¯ä»¶å®‰è£…å’Œé…ç½® node.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL sudo yum -y update sudo yum -y install net-tools sudo yum -y install vim SHELL end end (14..15).each do |i| config.vm.define &quot;k8s-node#&#123;i&#125;&quot; do |node| # è®¾ç½®è™šæ‹Ÿæœºçš„Box node.vm.box = &quot;centos/7&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå node.vm.hostname=&quot;node#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„IP node.vm.network &quot;public_network&quot;, ip: &quot;192.168.7.#&#123;i&#125;&quot;, :bridge=&gt;&apos;en0: Wi-Fi (AirPort)&apos; node.vm.boot_timeout = 20 # è®¾ç½®ä¸»æœºä¸Žè™šæ‹Ÿæœºçš„å…±äº«ç›®å½• node.vm.synced_folder &quot;/Users/sunbjx/Vagrant/share&quot;, &quot;/home/vagrant/share&quot; # VirtaulBoxç›¸å…³é…ç½® node.vm.provider &quot;virtualbox&quot; do |v| # è®¾ç½®è™šæ‹Ÿæœºçš„åç§° v.name = &quot;k8s-node#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å° v.memory = 8192 # è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•° v.cpus = 2 end # ä½¿ç”¨shellè„šæœ¬è¿›è¡Œè½¯ä»¶å®‰è£…å’Œé…ç½® node.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL sudo yum -y update sudo yum -y install net-tools sudo yum -y install vim SHELL end endend 2ã€å¯åŠ¨å®‰è£…centos7 1vagrant up çŽ¯å¢ƒè¯´æ˜ŽçŽ¯å¢ƒæ€»å…± 5 å°è™šæ‹Ÿæœºï¼Œ3 ä¸ª masterï¼Œ3 ä¸ª etcd èŠ‚ç‚¹ï¼Œ2 ä¸ª node ç½‘ç»œæ–¹æ¡ˆè¿™é‡Œé‡‡ç”¨flannelï¼Œé›†ç¾¤å¼€å¯ RBAC IP èŠ‚ç‚¹ 192.168.7.11 masterã€etcd 192.168.7.12 masterã€etcd 192.168.7.13 masterã€etcd 192.168.7.14 node 192.168.7.15 node åˆ›å»º TLSè¯ä¹¦å’Œç§˜é’¥è¯ä¹¦è¯´æ˜Ž è¯ä¹¦åç§° é…ç½®æ–‡ä»¶ ç”¨é€” etcd-root-ca.pem etcd-root-ca-csr.json etcd æ ¹ CA è¯ä¹¦ etcd.pem etcd-gencert.jsonã€etcd-csr.json etcd é›†ç¾¤è¯ä¹¦ k8s-root-ca.pem k8s-root-ca-csr.json k8s æ ¹ CA è¯ä¹¦ kube-proxy.pem k8s-gencert.jsonã€kube-proxy-csr.json kube-proxy ä½¿ç”¨çš„è¯ä¹¦ admin.pem k8s-gencert.jsonã€admin-csr.json kubectl ä½¿ç”¨çš„è¯ä¹¦ kubernetes.pem k8s-gencert.jsonã€kubernetes-csr.json kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ å®‰è£…CFSSL (192.168.7.11)12345678910111213mkdir -p ~/downloadcd ~/download# ä¸‹è½½ go1.8.3wget https://golang.org/dl/go1.8.3.linux-amd64.tar.gz# è§£åŽ‹åŽ‹ç¼©åŒ…tar -C /usr/local -xzf go1.8.3.linux-amd64.tar.gz# æ·»åŠ çŽ¯å¢ƒå˜é‡vim /etc/profileexport GOROOT=/usr/local/goexport PATH=$PATH:$GOROOT/binsource /etc/profile# ä½¿ç”¨ go å‘½ä»¤å®‰è£… cfsslgo get -u github.com/cloudflare/cfssl/cmd/... ç”Ÿæˆetcdè¯ä¹¦ (192.168.7.11) etcd è¯ä¹¦é…ç½®æ–‡ä»¶ 12mkdir -p ~/document/sslcd ~/document/ssl vim etcd-root-ca-csr.json 12345678910111213141516&#123; &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 4096 &#125;, &quot;names&quot;: [ &#123; &quot;O&quot;: &quot;etcd&quot;, &quot;OU&quot;: &quot;etcd Security&quot;, &quot;L&quot;: &quot;Beijing&quot;, &quot;ST&quot;: &quot;Beijing&quot;, &quot;C&quot;: &quot;CN&quot; &#125; ], &quot;CN&quot;: &quot;etcd-root-ca&quot;&#125; vim etcd-gencert.json 12345678910111213&#123; &quot;signing&quot;: &#123; &quot;default&quot;: &#123; &quot;usages&quot;: [ &quot;signing&quot;, &quot;key encipherment&quot;, &quot;server auth&quot;, &quot;client auth&quot; ], &quot;expiry&quot;: &quot;87600h&quot; &#125; &#125;&#125; vim etcd-csr.json 12345678910111213141516171819202122232425&#123; &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 4096 &#125;, &quot;names&quot;: [ &#123; &quot;O&quot;: &quot;etcd&quot;, &quot;OU&quot;: &quot;etcd Security&quot;, &quot;L&quot;: &quot;Beijing&quot;, &quot;ST&quot;: &quot;Beijing&quot;, &quot;C&quot;: &quot;CN&quot; &#125; ], &quot;CN&quot;: &quot;etcd&quot;, &quot;hosts&quot;: [ &quot;127.0.0.1&quot;, &quot;localhost&quot;, &quot;192.168.1.11&quot;, &quot;192.168.1.12&quot;, &quot;192.168.1.13&quot;, &quot;192.168.1.14&quot;, &quot;192.168.1.15&quot; ]&#125; â€œCNâ€ï¼šCommon Nameï¼Œkube-apiserver ä»Žè¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·å (User Name)ï¼›æµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘ç«™æ˜¯å¦åˆæ³•ï¼›â€œOâ€ï¼šOrganizationï¼Œkube-apiserver ä»Žè¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚ç”¨æˆ·æ‰€å±žçš„ç»„ (Group) ç”Ÿæˆ etcd è¯ä¹¦ 12cfssl gencert --initca=true etcd-root-ca-csr.json | cfssljson --bare etcd-root-cacfssl gencert --ca etcd-root-ca.pem --ca-key etcd-root-ca-key.pem --config etcd-gencert.json etcd-csr.json | cfssljson --bare etcd ç”Ÿæˆ kubernetes è¯ä¹¦ (192.168.7.11) kubernetes è¯ä¹¦é…ç½®æ–‡ä»¶ vim k8s-root-ca-csr.json 12345678910111213141516&#123; &quot;CN&quot;: &quot;kubernetes&quot;, &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 4096 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; vim k8s-gencert.json 123456789101112131415161718&#123; &quot;signing&quot;: &#123; &quot;default&quot;: &#123; &quot;expiry&quot;: &quot;87600h&quot; &#125;, &quot;profiles&quot;: &#123; &quot;kubernetes&quot;: &#123; &quot;usages&quot;: [ &quot;signing&quot;, &quot;key encipherment&quot;, &quot;server auth&quot;, &quot;client auth&quot; ], &quot;expiry&quot;: &quot;87600h&quot; &#125; &#125; &#125;&#125; vim kubernetes-csr.json 12345678910111213141516171819202122232425262728293031&#123; &quot;CN&quot;: &quot;kubernetes&quot;, &quot;hosts&quot;: [ &quot;127.0.0.1&quot;, &quot;10.254.0.1&quot;, &quot;192.168.7.11&quot;, &quot;192.168.7.12&quot;, &quot;192.168.7.13&quot;, &quot;192.168.7.14&quot;, &quot;192.168.7.15&quot;, &quot;localhost&quot;, &quot;kubernetes&quot;, &quot;kubernetes.default&quot;, &quot;kubernetes.default.svc&quot;, &quot;kubernetes.default.svc.cluster&quot;, &quot;kubernetes.default.svc.cluster.local&quot; ], &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; vim kube-proxy-csr.json 1234567891011121314151617&#123; &quot;CN&quot;: &quot;system:kube-proxy&quot;, &quot;hosts&quot;: [], &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; vim admin-csr.json 1234567891011121314151617&#123; &quot;CN&quot;: &quot;admin&quot;, &quot;hosts&quot;: [], &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;system:masters&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; ç”Ÿæˆ kubernetes è¯ä¹¦ 12345cfssl gencert --initca=true k8s-root-ca-csr.json | cfssljson --bare k8s-root-cafor targetName in kubernetes admin kube-proxy; do cfssl gencert --ca k8s-root-ca.pem --ca-key k8s-root-ca-key.pem --config k8s-gencert.json --profile kubernetes $targetName-csr.json | cfssljson --bare $targetNamedone åˆ†å‘æ‰€éœ€è¯ä¹¦åˆ°å„ä¸ªèŠ‚ç‚¹ç›®å½• /etc/kubernetes/ssl ä¸‹é¢ 123456789for IP in `seq 1 5`;do ssh root@192.168.1.1$IP mkdir -p /etc/etcd/ssl sudo scp ~/document/ssl/etcd*.pem root@192.168.1.1$IP:/etc/etcd/ssl ssh root@192.168.1.1$IP chown -R etcd:etcd /etc/etcd/ssl ssh root@192.168.1.1$IP chmod -R 755 /etc/etcd ssh root@192.168.7.1$IP mkdir -p /etc/kubernetes/ssl sudo scp ~/document/ssl/*.pem root@192.168.7.1$IP:/etc/kubernetes/ssl ssh root@192.168.7.1$IP chown -R kube:kube /etc/kubernetes/ssldone ç”Ÿæˆ token åŠ kubeconfig (192.168.7.11)kubeletã€kube-proxy ç­‰ Node æœºå™¨ä¸Šçš„è¿›ç¨‹ä¸Ž Master æœºå™¨çš„ kube-apiserver è¿›ç¨‹é€šä¿¡æ—¶éœ€è¦è®¤è¯å’ŒæŽˆæƒï¼›kubernetes 1.4 å¼€å§‹æ”¯æŒç”± kube-apiserver ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆ TLS è¯ä¹¦çš„ TLS Bootstrapping åŠŸèƒ½ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆè¯ä¹¦äº†ï¼›è¯¥åŠŸèƒ½å½“å‰ä»…æ”¯æŒä¸º kubelet ç”Ÿæˆè¯ä¹¦ ç”Ÿæˆ token 12345cd /etc/kubernetesexport BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &apos; &apos;)cat &gt; token.csv &lt;&lt;EOF$&#123;BOOTSTRAP_TOKEN&#125;,kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;EOF BOOTSTRAP_TOKEN å°†è¢«å†™å…¥åˆ° kube-apiserver ä½¿ç”¨çš„ token.csv æ–‡ä»¶å’Œ kubelet ä½¿ç”¨çš„ bootstrap.kubeconfig æ–‡ä»¶ï¼Œå¦‚æžœåŽç»­é‡æ–°ç”Ÿæˆäº† BOOTSTRAP_TOKENï¼Œåˆ™éœ€è¦ï¼šæ›´æ–° token.csv æ–‡ä»¶ï¼Œåˆ†å‘åˆ°æ‰€æœ‰æœºå™¨ (master å’Œ nodeï¼‰çš„ /etc/kubernetes/ ç›®å½•ä¸‹ï¼Œåˆ†å‘åˆ°nodeèŠ‚ç‚¹ä¸Šéžå¿…éœ€ï¼›é‡æ–°ç”Ÿæˆ bootstrap.kubeconfig æ–‡ä»¶ï¼Œåˆ†å‘åˆ°æ‰€æœ‰ node æœºå™¨çš„ /etc/kubernetes/ ç›®å½•ä¸‹ï¼›é‡å¯ kube-apiserver å’Œ kubelet è¿›ç¨‹ï¼›é‡æ–° approve kubelet çš„ csr è¯·æ±‚ å®‰è£… kubernetes å¹¶å°† kube-apiserver,kube-controller-manager,kube-scheduler,kubectl åˆ†å‘åˆ° master; kubelet,kube-proxy åˆ†å‘åˆ° node; åŒæ—¶åˆ†å‘æ‰€éœ€è¯ä¹¦åˆ°å„ä¸ªèŠ‚ç‚¹ç›®å½• /etc/kubernetes/ssl ä¸‹é¢ 123456789101112131415161718cd ~/downloadwget https://github.com/kubernetes/kubernetes/releases/download/v1.7.4/kubernetes.tar.gztar -zxvf kubernetes.tar.gzcd kubernetes./cluster/get-kube-binaries.shcd kubernetes/servertar -zxvf kubernetes-server-linux-amd64.tar.gzcd kubernetes/server/binfor IP in `seq 1 3`;do sudo scp ./&#123;kube-apiserver,kube-controller-manager,kube-scheduler,kubectl&#125; root@192.168.7.1$IP:/usr/local/bin/ ssh root@192.168.7.1$IP chmod a+x /usr/local/bin/kube*donefor IP in `seq 4 5`;do sudo scp ./&#123;kubelet,kube-proxy&#125; root@192.168.7.1$IP:/usr/local/bin ssh root@192.168.7.1$IP chmod a+x /usr/local/bin/kube*done åˆ›å»º kubelet bootstrapping kubeconfig æ–‡ä»¶ 12345678910111213141516171819cd /etc/kubernetesexport KUBE_APISERVER=&quot;https://192.168.7.11:6443&quot;# è®¾ç½®é›†ç¾¤å‚æ•°kubectl config set-cluster kubernetes \ --certificate-authority=/etc/kubernetes/ssl/k8s-root-ca.pem \ --embed-certs=true \ --server=$&#123;KUBE_APISERVER&#125; \ --kubeconfig=bootstrap.kubeconfig# è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°kubectl config set-credentials kubelet-bootstrap \ --token=$&#123;BOOTSTRAP_TOKEN&#125; \ --kubeconfig=bootstrap.kubeconfig# è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°kubectl config set-context default \ --cluster=kubernetes \ --user=kubelet-bootstrap \ --kubeconfig=bootstrap.kubeconfig# è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡kubectl config use-context default --kubeconfig=bootstrap.kubeconfig â€“embed-certs ä¸º true æ—¶è¡¨ç¤ºå°† certificate-authority è¯ä¹¦å†™å…¥åˆ°ç”Ÿæˆçš„ bootstrap.kubeconfig æ–‡ä»¶ä¸­ï¼›è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°æ—¶æ²¡æœ‰æŒ‡å®šç§˜é’¥å’Œè¯ä¹¦ï¼ŒåŽç»­ç”± kube-apiserver è‡ªåŠ¨ç”Ÿæˆ åˆ›å»º kube-proxy kubeconfig æ–‡ä»¶ 12345678910111213141516171819# è®¾ç½®é›†ç¾¤å‚æ•°kubectl config set-cluster kubernetes \ --certificate-authority=/etc/kubernetes/ssl/k8s-root-ca.pem \ --embed-certs=true \ --server=$&#123;KUBE_APISERVER&#125; \ --kubeconfig=kube-proxy.kubeconfig# è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°kubectl config set-credentials kube-proxy \ --client-certificate=/etc/kubernetes/ssl/kube-proxy.pem \ --client-key=/etc/kubernetes/ssl/kube-proxy-key.pem \ --embed-certs=true \ --kubeconfig=kube-proxy.kubeconfig# è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°kubectl config set-context default \ --cluster=kubernetes \ --user=kube-proxy \ --kubeconfig=kube-proxy.kubeconfig# è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig è®¾ç½®é›†ç¾¤å‚æ•°å’Œå®¢æˆ·ç«¯è®¤è¯å‚æ•°æ—¶ â€“embed-certs éƒ½ä¸º trueï¼Œè¿™ä¼šå°† certificate-authorityã€client-certificate å’Œ client-key æŒ‡å‘çš„è¯ä¹¦æ–‡ä»¶å†…å®¹å†™å…¥åˆ°ç”Ÿæˆçš„ kube-proxy.kubeconfig æ–‡ä»¶ä¸­ï¼›kube-proxy.pem è¯ä¹¦ä¸­ CN ä¸º system:kube-proxyï¼Œkube-apiserver é¢„å®šä¹‰çš„ RoleBinding cluster-admin å°†User system:kube-proxy ä¸Ž Role system:node-proxier ç»‘å®šï¼Œè¯¥ Role æŽˆäºˆäº†è°ƒç”¨ kube-apiserver Proxy ç›¸å…³ API çš„æƒé™ åˆ†å‘ tokenã€kubeconfig æ–‡ä»¶ 1234for IP in `seq 2 5`;do scp *.kubeconfig root@192.168.7.1$IP:/etc/kubernetes scp token.csv root@192.168.7.1$IP:/etc/kubernetesdone éƒ¨ç½² HA etcdå®‰è£… etcd123sudo yum -y install etcdecho &apos;export ETCDCTL_API=3&apos; &gt;&gt; /etc/profilesource /etc/profile ä¿®æ”¹é…ç½® vim /etc/etcd/etc.conf123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# [member]ETCD_NAME=etcd1ETCD_DATA_DIR=&quot;/var/lib/etcd/etcd1.etcd&quot;ETCD_WAL_DIR=&quot;/var/lib/etcd/wal&quot;ETCD_SNAPSHOT_COUNT=&quot;100&quot;ETCD_HEARTBEAT_INTERVAL=&quot;100&quot;ETCD_ELECTION_TIMEOUT=&quot;1000&quot;ETCD_LISTEN_PEER_URLS=&quot;https://192.168.7.11:2380&quot;ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.7.11:2379,http://127.0.0.1:2379&quot;ETCD_MAX_SNAPSHOTS=&quot;5&quot;ETCD_MAX_WALS=&quot;5&quot;#ETCD_CORS=&quot;&quot;##[cluster]ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.7.11:2380&quot;# if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. &quot;test=http://...&quot;ETCD_INITIAL_CLUSTER=&quot;etcd1=https://192.168.7.11:2380,etcd2=https://192.168.7.12:2380,etcd3=https://192.168.7.13:2380&quot;ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.7.11:2379&quot;#ETCD_DISCOVERY=&quot;&quot;#ETCD_DISCOVERY_SRV=&quot;&quot;#ETCD_DISCOVERY_FALLBACK=&quot;proxy&quot;#ETCD_DISCOVERY_PROXY=&quot;&quot;#ETCD_STRICT_RECONFIG_CHECK=&quot;false&quot;#ETCD_AUTO_COMPACTION_RETENTION=&quot;0&quot;##[proxy]#ETCD_PROXY=&quot;off&quot;#ETCD_PROXY_FAILURE_WAIT=&quot;5000&quot;#ETCD_PROXY_REFRESH_INTERVAL=&quot;30000&quot;#ETCD_PROXY_DIAL_TIMEOUT=&quot;1000&quot;#ETCD_PROXY_WRITE_TIMEOUT=&quot;5000&quot;#ETCD_PROXY_READ_TIMEOUT=&quot;0&quot;##[security]ETCD_CERT_FILE=&quot;/etc/etcd/ssl/etcd.pem&quot;ETCD_KEY_FILE=&quot;/etc/etcd/ssl/etcd-key.pem&quot;ETCD_CLIENT_CERT_AUTH=&quot;true&quot;ETCD_TRUSTED_CA_FILE=&quot;/etc/etcd/ssl/etcd-root-ca.pem&quot;ETCD_AUTO_TLS=&quot;true&quot;ETCD_PEER_CERT_FILE=&quot;/etc/etcd/ssl/etcd.pem&quot;ETCD_PEER_KEY_FILE=&quot;/etc/etcd/ssl/etcd-key.pem&quot;ETCD_PEER_CLIENT_CERT_AUTH=&quot;true&quot;ETCD_PEER_TRUSTED_CA_FILE=&quot;/etc/etcd/ssl/etcd-root-ca.pem&quot;ETCD_PEER_AUTO_TLS=&quot;true&quot;##[logging]#ETCD_DEBUG=&quot;false&quot;# examples for -log-package-levels etcdserver=WARNING,security=DEBUG#ETCD_LOG_PACKAGE_LEVELS=&quot;&quot; å¯åŠ¨åŠéªŒè¯ é…ç½®ä¿®æ”¹åŽåœ¨æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œå¯åŠ¨å³å¯ï¼Œæ³¨æ„ï¼ŒEtcd å„ä¸ªèŠ‚ç‚¹é—´å¿…é¡»ä¿è¯æ—¶é’ŸåŒæ­¥ï¼Œå¦åˆ™ä¼šé€ æˆå¯åŠ¨å¤±è´¥ç­‰é”™è¯¯ 1234567yum -y install ntpsystemctl start ntpdsystemctl enable ntpdhwclock --systohcsystemctl daemon-reloadsystemctl start etcdsystemctl enable etcd éªŒè¯ etcd é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ 12export ETCDCTL_API=3etcdctl --cacert=/etc/etcd/ssl/etcd-root-ca.pem --cert=/etc/etcd/ssl/etcd.pem --key=/etc/etcd/ssl/etcd-key.pem --endpoints=https://192.168.7.11:2379,https://192.168.7.12:2379,https://192.168.7.13:2379 endpoint health éƒ¨ç½² HA masterç”±äºŽ api server ä¼šå†™å…¥ä¸€äº›æ—¥å¿—ï¼Œæ‰€ä»¥å…ˆåˆ›å»ºå¥½ç›¸å…³ç›®å½•ï¼Œå¹¶åšå¥½æŽˆæƒï¼Œé˜²æ­¢å› ä¸ºæƒé™é”™è¯¯å¯¼è‡´ api server æ— æ³•å¯åŠ¨ 12345for IP in `seq 1 3`;do ssh root@192.168.1.1$IP mkdir /var/log/kube-audit ssh root@192.168.1.1$IP chown -R kube:kube /var/log/kube-audit ssh root@192.168.1.1$IP chmod -R 755 /var/log/kube-auditdone åˆ›å»º kube-apiserverçš„serviceé…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/kube-apiserver.service 1234567891011121314151617181920212223242526[Unit]Description=Kubernetes API ServiceDocumentation=https://github.com/GoogleCloudPlatform/kubernetesAfter=network.targetAfter=etcd.service[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/apiserverExecStart=/usr/local/bin/kube-apiserver \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_ETCD_SERVERS \ $KUBE_API_ADDRESS \ $KUBE_API_PORT \ $KUBELET_PORT \ $KUBE_ALLOW_PRIV \ $KUBE_SERVICE_ADDRESSES \ $KUBE_ADMISSION_CONTROL \ $KUBE_API_ARGSRestart=on-failureType=notifyLimitNOFILE=65536[Install]WantedBy=multi-user.target åˆ›å»º kube-controller-managerçš„serivceé…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/kube-controller-manager.service 12345678910111213141516Description=Kubernetes Controller ManagerDocumentation=https://github.com/GoogleCloudPlatform/kubernetes[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/controller-managerExecStart=/usr/local/bin/kube-controller-manager \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_MASTER \ $KUBE_CONTROLLER_MANAGER_ARGSRestart=on-failureLimitNOFILE=65536[Install]WantedBy=multi-user.target åˆ›å»º kube-schedulerçš„serivceé…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/kube-scheduler.service 1234567891011121314151617[Unit]Description=Kubernetes Scheduler PluginDocumentation=https://github.com/GoogleCloudPlatform/kubernetes[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/schedulerExecStart=/usr/local/bin/kube-scheduler \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_MASTER \ $KUBE_SCHEDULER_ARGSRestart=on-failureLimitNOFILE=65536[Install]WantedBy=multi-user.target ä¿®æ”¹ master é…ç½®master éœ€è¦ç¼–è¾‘ configã€apiserverã€controller-managerã€schedulerè¿™å››ä¸ªæ–‡ä»¶ï¼Œå…·ä½“ä¿®æ”¹å¦‚ä¸‹ config é€šç”¨é…ç½®vim /etc/kubernetes/config 12345678910111213141516171819202122#### kubernetes system config## The following values are used to configure various aspects of all# kubernetes services, including## kube-apiserver.service# kube-controller-manager.service# kube-scheduler.service# kubelet.service# kube-proxy.service# logging to stderr means we get it in the systemd journalKUBE_LOGTOSTDERR=&quot;--logtostderr=true&quot;# journal message level, 0 is debugKUBE_LOG_LEVEL=&quot;--v=2&quot;# Should this cluster be allowed to run privileged docker containersKUBE_ALLOW_PRIV=&quot;--allow-privileged=true&quot;# How the controller-manager, scheduler, and proxy find the apiserverKUBE_MASTER=&quot;--master=http://127.0.0.1:8080&quot; apiserver é…ç½®(å…¶ä»–èŠ‚ç‚¹åªæœ‰ IP ä¸åŒ) vim /etc/kubernetes/apiserver 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#### kubernetes system config## The following values are used to configure the kube-apiserver## The address on the local server to listen to.KUBE_API_ADDRESS=&quot;--advertise-address=192.168.7.11 --insecure-bind-address=127.0.0.1 --bind-address=192.168.7.11&quot;# The port on the local server to listen on.KUBE_API_PORT=&quot;--insecure-port=8080 --secure-port=6443&quot;# Port minions listen on# KUBELET_PORT=&quot;--kubelet-port=10250&quot;# Comma separated list of nodes in the etcd clusterKUBE_ETCD_SERVERS=&quot;--etcd-servers=https://192.168.7.11:2379,https://192.168.7.12:2379,https://192.168.7.13:2379&quot;# Address range to use for servicesKUBE_SERVICE_ADDRESSES=&quot;--service-cluster-ip-range=10.254.0.0/16&quot;# default admission control policiesKUBE_ADMISSION_CONTROL=&quot;--admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota&quot;# Add your own!KUBE_API_ARGS=&quot;--authorization-mode=RBAC \ --runtime-config=rbac.authorization.k8s.io/v1beta1 \ --anonymous-auth=false \ --kubelet-https=true \ --experimental-bootstrap-token-auth \ --token-auth-file=/etc/kubernetes/token.csv \ --service-node-port-range=30000-50000 \ --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem \ --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem \ --client-ca-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --service-account-key-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --etcd-quorum-read=true \ --storage-backend=etcd3 \ --etcd-cafile=/etc/etcd/ssl/etcd-root-ca.pem \ --etcd-certfile=/etc/etcd/ssl/etcd.pem \ --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \ --enable-swagger-ui=true \ --apiserver-count=3 \ --audit-log-maxage=30 \ --audit-log-maxbackup=3 \ --audit-log-maxsize=100 \ --audit-log-path=/var/log/kube-audit/audit.log \ --event-ttl=1h&quot; controller-manager é…ç½® vim /etc/kubernetes/controller-manager 1234567891011121314151617#### The following values are used to configure the kubernetes controller-manager# defaults from config and apiserver should be adequate# Add your own!KUBE_CONTROLLER_MANAGER_ARGS=&quot;--address=127.0.0.1 \ --service-cluster-ip-range=10.254.0.0/16 \ --cluster-name=kubernetes \ --cluster-signing-cert-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --cluster-signing-key-file=/etc/kubernetes/ssl/k8s-root-ca-key.pem \ --service-account-private-key-file=/etc/kubernetes/ssl/k8s-root-ca-key.pem \ --root-ca-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --leader-elect=true \ --node-monitor-grace-period=40s \ --node-monitor-period=5s \ --pod-eviction-timeout=5m0s&quot; scheduler é…ç½® vim /etc/kubernetes/scheduler 1234567#### kubernetes scheduler config# default config should be adequate# Add your own!KUBE_SCHEDULER_ARGS=&quot;--leader-elect=true --address=127.0.0.1&quot; å…¶ä»– master èŠ‚ç‚¹é…ç½®ç›¸åŒï¼Œåªéœ€è¦ä¿®æ”¹ä»¥ä¸‹ IP åœ°å€å³å¯ å¯åŠ¨å„ master èŠ‚ç‚¹ç›¸å…³æœåŠ¡1234567systemctl daemon-reloadsystemctl start kube-apiserversystemctl start kube-controller-managersystemctl start kube-schedulersystemctl enable kube-apiserversystemctl enable kube-controller-managersystemctl enable kube-scheduler éªŒè¯ master èŠ‚ç‚¹åŠŸèƒ½ éƒ¨ç½² nodeåˆ›å»º ClusterRoleBindingkubelet å¯åŠ¨æ—¶å‘ kube-apiserver å‘é€ TLS bootstrapping è¯·æ±‚ï¼Œéœ€è¦å…ˆå°† bootstrap token æ–‡ä»¶ä¸­çš„ kubelet-bootstrap ç”¨æˆ·èµ‹äºˆ system:node-bootstrapper cluster è§’è‰²(role)ï¼Œ ç„¶åŽ kubelet æ‰èƒ½æœ‰æƒé™åˆ›å»ºè®¤è¯è¯·æ±‚(certificate signing requests)ï¼š 1234# åœ¨ä»»æ„ master æ‰§è¡Œå³å¯kubectl create clusterrolebinding kubelet-bootstrap \ --clusterrole=system:node-bootstrapper \ --user=kubelet-bootstrap åˆ›å»º kubelet çš„serviceé…ç½®æ–‡ä»¶/usr/lib/systemd/system/kubelet.service 123456789101112131415161718192021222324[Unit]Description=Kubernetes Kubelet ServerDocumentation=https://github.com/GoogleCloudPlatform/kubernetesAfter=docker.serviceRequires=docker.service[Service]WorkingDirectory=/var/lib/kubeletEnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/kubeletExecStart=/usr/local/bin/kubelet \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBELET_API_SERVER \ $KUBELET_ADDRESS \ $KUBELET_PORT \ $KUBELET_HOSTNAME \ $KUBE_ALLOW_PRIV \ $KUBELET_POD_INFRA_CONTAINER \ $KUBELET_ARGSRestart=on-failure[Install]WantedBy=multi-user.target åˆ›å»º kube-proxy çš„serviceé…ç½®æ–‡ä»¶/usr/lib/systemd/system/kube-proxy.service 123456789101112131415161718[Unit]Description=Kubernetes Kube-Proxy ServerDocumentation=https://github.com/GoogleCloudPlatform/kubernetesAfter=network.target[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/proxyExecStart=/usr/local/bin/kube-proxy \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_MASTER \ $KUBE_PROXY_ARGSRestart=on-failureLimitNOFILE=65536[Install]WantedBy=multi-user.target config é€šç”¨é…ç½® 12345678910111213141516171819202122#### kubernetes system config## The following values are used to configure various aspects of all# kubernetes services, including## kube-apiserver.service# kube-controller-manager.service# kube-scheduler.service# kubelet.service# kube-proxy.service# logging to stderr means we get it in the systemd journalKUBE_LOGTOSTDERR=&quot;--logtostderr=true&quot;# journal message level, 0 is debugKUBE_LOG_LEVEL=&quot;--v=2&quot;# Should this cluster be allowed to run privileged docker containersKUBE_ALLOW_PRIV=&quot;--allow-privileged=true&quot;# How the controller-manager, scheduler, and proxy find the apiserver# KUBE_MASTER=&quot;--master=http://127.0.0.1:8080&quot; kubelet é…ç½® 123456789101112131415161718192021222324252627#### kubernetes kubelet (minion) config# The address for the info server to serve on (set to 0.0.0.0 or &quot;&quot; for all interfaces)KUBELET_ADDRESS=&quot;--address=192.168.7.14&quot;# The port for the info server to serve on# KUBELET_PORT=&quot;--port=10250&quot;# You may leave this blank to use the actual hostnameKUBELET_HOSTNAME=&quot;--hostname-override=docker4.node&quot;# location of the api-server#KUBELET_API_SERVER=&quot;--api-servers=http://192.168.7.11:8080&quot;# Add your own!KUBELET_ARGS=&quot;--cgroup-driver=cgroupfs \ --cluster-dns=10.254.0.2 \ --resolv-conf=/etc/resolv.conf \ --experimental-bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \ --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \ --require-kubeconfig \ --cert-dir=/etc/kubernetes/ssl \ --cluster-domain=cluster.local \ --hairpin-mode promiscuous-bridge \ --serialize-image-pulls=false \ --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.0&quot; proxy é…ç½® 12345678910#### kubernetes proxy config# default config should be adequate# Add your own!KUBE_PROXY_ARGS=&quot;--bind-address=192.168.7.14 \ --hostname-override=docker4.node \ --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig \ --cluster-cidr=10.254.0.0/16&quot; åˆ›å»º nginx ä»£ç†æ ¹æ®ä¸Šé¢æè¿°çš„ master HA æž¶æž„ï¼Œæ­¤æ—¶æ‰€æœ‰ node åº”è¯¥è¿žæŽ¥æœ¬åœ°çš„ nginx ä»£ç†ï¼Œç„¶åŽ nginx æ¥è´Ÿè½½æ‰€æœ‰ api serverï¼›ä»¥ä¸‹ä¸º nginx ä»£ç†ç›¸å…³é…ç½® 123456789101112131415161718192021222324252627282930313233# åˆ›å»ºé…ç½®ç›®å½•mkdir -p /etc/nginx# å†™å…¥ä»£ç†é…ç½®cat &lt;&lt; EOF &gt;&gt; /etc/nginx/nginx.conferror_log stderr notice;worker_processes auto;events &#123; multi_accept on; use epoll; worker_connections 1024;&#125;stream &#123; upstream kube_apiserver &#123; least_conn; server 192.168.7.11:6443; server 192.168.7.12:6443; server 192.168.7.13:6443; &#125; server &#123; listen 0.0.0.0:6443; proxy_pass kube_apiserver; proxy_timeout 10m; proxy_connect_timeout 1s; &#125;&#125;EOF# æ›´æ–°æƒé™chmod +r /etc/nginx/nginx.conf ä¸ºäº†ä¿è¯ nginx çš„å¯é æ€§ï¼Œç»¼åˆä¾¿æ·æ€§è€ƒè™‘ï¼Œnode èŠ‚ç‚¹ä¸Šçš„ nginx ä½¿ç”¨ docker å¯åŠ¨ï¼ŒåŒæ—¶ ä½¿ç”¨ systemd æ¥å®ˆæŠ¤ï¼Œ systemd é…ç½®å¦‚ä¸‹ 12345678910111213141516171819202122232425cat &lt;&lt; EOF &gt;&gt; /etc/systemd/system/nginx-proxy.service[Unit]Description=kubernetes apiserver docker wrapperWants=docker.socketAfter=docker.service[Service]User=rootPermissionsStartOnly=trueExecStart=/usr/bin/docker run -p 127.0.0.1:6443:6443 \\ -v /etc/nginx:/etc/nginx \\ --name nginx-proxy \\ --net=host \\ --restart=on-failure:5 \\ --memory=512M \\ nginx:1.13.3-alpineExecStartPre=-/usr/bin/docker rm -f nginx-proxyExecStop=/usr/bin/docker stop nginx-proxyRestart=alwaysRestartSec=15sTimeoutStartSec=30s[Install]WantedBy=multi-user.targetEOF å¯åŠ¨ kubeletã€nginx-proxy1234567systemctl daemon-reloadsystemctl start kubeletsystemctl enable kubeletsystemctl start kube-proxysystemctl enable kube-proxysystemctl start nginx-proxysystemctl enable nginx-proxy master èŠ‚ç‚¹éªŒè¯è¿žé€šæ€§1kubectl --server https://192.168.7.11:6443 --certificate-authority /etc/kubernetes/ssl/k8s-root-ca.pem --client-certificate /etc/kubernetes/ssl/admin.pem --client-key /etc/kubernetes/ssl/admin-key.pem get cs 12345678910111213# æŸ¥çœ‹ csrâžœ kubectl get csrNAME AGE REQUESTOR CONDITIONnode-csr-PhOGHB8BpFuNoYtnCGka4NTaxtDQDRjrctZtdaVsijY 2m kubelet-bootstrap Pending# ç­¾å‘è¯ä¹¦âžœ kubectl certificate approve node-csr-PhOGHB8BpFuNoYtnCGka4NTaxtDQDRjrctZtdaVsijYcertificatesigningrequest &quot;node-csr-PhOGHB8BpFuNoYtnCGka4NTaxtDQDRjrctZtdaVsijY&quot; approved# æŸ¥çœ‹ nodeâžœ kubectl get nodeNAME STATUS AGE VERSIONdocker4.node Ready 20s v1.7.4 å®‰è£… kubedns æ’ä»¶å®‰è£… dashboard æ’ä»¶å®‰è£… heapster æ’ä»¶å®‰è£… EFK æ’ä»¶éƒ¨ç½² harbor ç§æœ‰ä»“åº“]]></content>
      <categories>
        <category>devops</category>
        <category>kubernetes</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ‚Ÿé€è‡ªå·±]]></title>
    <url>%2F2017%2F09%2F09%2F%E6%82%9F%E9%80%8F%E8%87%AA%E5%B7%B1%2F</url>
    <content type="text"><![CDATA[&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;äººç”Ÿåœ¨ä¸–,å’Œâ€œè‡ªå·±â€ç›¸å¤„æœ€å¤š, ä½†æ˜¯å¾€å¾€æ‚Ÿä¸é€â€œè‡ªå·±â€. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;äººç”Ÿèµ°ä¸Šå¡è·¯æ—¶,å¾€å¾€æŠŠè‡ªå·±ä¼°è®¡è¿‡é«˜,ä¼¼ä¹Žä¸€åˆ‡æ‰€æ±‚çš„ä¸œè¥¿éƒ½èƒ½å”¾æ‰‹å¯å¾—,ç”šè‡³æŠŠè¿æ°”å’Œæœºé‡ä¹Ÿçœ‹ä½œè‡ªå·±èº«ä»·çš„ä¸€éƒ¨åˆ†è€Œå–œä¸è‡ªèƒœ.äººåœ¨ä¸å¾—æ„æ—¶,åˆå¾€å¾€æŠŠè‡ªå·±ä¼°è®¡è¿‡ä½Ž,æŠŠå›°éš¾å’Œä¸åˆ©ä¹Ÿçœ‹åšè‡ªå·±çš„æ— èƒ½,ä»¥è‡³äºŽæŠŠå®‰åˆ†å®ˆå·±,ä¸Žä¸–æ— äº‰è¯¯è®¤ä¸ºæœ‰è‡ªçŸ¥ä¹‹æ˜Ž,è€Œå®žé™…ä¸Šå¾€å¾€è¢«æ€¯æ‡¦çš„é¢å…·çª’æ¯äº†è‡ªå·±é²œæ´»çš„ç”Ÿå‘½. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‚Ÿé€è‡ªå·±,å°±æ˜¯æ­£ç¡®è®¤è¯†è‡ªå·±,ä¹Ÿå°±æ˜¯è¯´è¦åšä¸€ä¸ªå†·é™çš„çŽ°å®žä¸»ä¹‰è€…,æ—¢çŸ¥é“è‡ªå·±çš„ä¼˜åŠ¿,ä¹ŸçŸ¥é“è‡ªå·±çš„ä¸è¶³.æˆ‘ä»¬å¯ä»¥æ†§æ†¬äººç”Ÿ,ä½†æœŸæœ›å€¼ä¸èƒ½è¿‡é«˜.å› ä¸ºåœ¨çŽ°å®žä¸­,ç†æƒ³æ€»æ˜¯ä¼šæ‰“æŠ˜æ‰£çš„.å¯ä»¥è¿ŽæŽ¥æŒ‘æˆ˜.ä½†æ˜¯å¿…é¡»æ¸…æ¥šè‡ªå·±åŠªåŠ›çš„æ–¹å‘.ä¹Ÿå°±æ˜¯è¯´,äººä¸€æ—¦æœ‰äº†è‡ªçŸ¥ä¹‹æ˜Ž,ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆå…‹æœä¸äº†çš„å›°éš¾,æ²¡æœ‰ä»€ä¹ˆè¿‡ä¸åŽ»çš„éš¾å…³. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;è¦æ‚Ÿé€è‡ªå·±å°±è¦æ¬£èµè‡ªå·±.æ— è®ºä½ æ˜¯ä¸€æ£µå‚å¤©å¤§æ ‘,è¿˜æ˜¯ä¸€æ£µå°è‰,æ— è®ºä½ æˆä¸ºä¸€åº§å·å³¨çš„é«˜å±±,è¿˜æ˜¯ä¸€å¿«å°å°çš„çŸ³å¤´,éƒ½æ˜¯ä¸€ç§å¤©ç„¶,éƒ½æœ‰è‡ªå·±å­˜åœ¨çš„ä»·å€¼.åªè¦ä½ è®¤çœŸçš„æ¬£èµè‡ªå·±,ä½ å°±ä¼šæ‹¥æœ‰ä¸€ä¸ªçœŸæ­£çš„è‡ªæˆ‘.åªæœ‰è‡ªæˆ‘æ¬£èµæ‰ä¼šæœ‰ä¿¡å¿ƒ,ä¸€æ—¦æ‹¥æœ‰äº†ä¿¡å¿ƒä¹Ÿå°±ä¼šæ‹¥æœ‰äº†æŠµå¾¡ä¸€åˆ‡é€†å¢ƒçš„åŠ¨åŠ›. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;è¦æ‚Ÿé€è‡ªå·±,å°±è¦å¿ƒç–¼è‡ªå·±.åœ¨æ°”æ„¤æ—¶å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,æ‰¾ä¸ªåƒ»é™å¤„æ•£æ•£å¿ƒ,å®£æ³„å®£æ³„,ä¸è¦è®©é‚£äº›æ— åä¹‹ç«ä¼¤èº«;å¿§éƒæ—¶,è¦å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,æ‰¾ä¸‰äº”å¥½å‹,è¯‰è¯´è¯‰è¯´,è®©æ„Ÿæƒ…çš„é˜´å¤©å˜æ™´;åŠ³ç´¯æ—¶,ä½ è¦å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,ä¸ºè‡ªå·±æ¥ä¸€ç•ªé—®å¯’é—®æš–,è¦æ˜Žç™½äººæ‰€æ‹¥æœ‰çš„ä¸è¿‡æ˜¯ä¸€ä¸ªè¡€è‚‰ä¹‹èº¯,ç»ä¸ä½å¤ªå¤šçš„é£ŽåŠ›éœœå‰‘;æœ‰ç—…æ—¶,ä½ è¦å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,æƒŸæœ‰å¯¹è‡ªå·±çš„å¿ƒç–¼,æ‰æ˜¯æˆ˜èƒœç–¾ç—…çš„ä¿¡å¿ƒå’ŒåŠ›é‡. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‚Ÿé€äº†è‡ªå·±,æ‰èƒ½æŠŠæ¡ä½è‡ªå·±,ä½ ç”Ÿæ´»æ‰ä¼šæœ‰æ»‹æœ‰å‘³!]]></content>
      <categories>
        <category>ESSAYS</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[JDKå®‰è£…é…ç½®]]></title>
    <url>%2F2017%2F09%2F08%2FJDK%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[ubuntu1ã€è§£åŽ‹æ–‡ä»¶å¹¶ä¿®æ”¹æ–‡ä»¶å 1sudo tar zxvf jdk-7u21-linux-i586.tar.gz -C /usr/lib/ è¿›å…¥åˆ°å®‰è£…ç›®å½•ä¸­ 1cd /usr/lib/ ä¿®æ”¹æ–‡ä»¶å 1sudo mv jdk1.7.0_21 java 2ã€æ·»åŠ çŽ¯å¢ƒå˜é‡ä½¿ç”¨vim ~/.bashrcå‘½ä»¤ç¼–è¾‘ 1234export JAVA_HOME=/usr/lib/javaexport JRE_HOME=$&#123;JAVA_HOME&#125;/jreexport CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/libexport PATH=$&#123;JAVA_HOME&#125;/bin:$PATH 3ã€æ¿€æ´»çŽ¯å¢ƒå˜é‡ 1source ~/.bashrc centos1ã€æŸ¥çœ‹JDKä¿¡æ¯ 1rpm -qa | grep java 2ã€å¸è½½OpenJDKâ€”â€”åœ¨ æ­¥éª¤ 1ä¸­ å¤åˆ¶æ‰€æœ‰çš„ openjdkå¸è½½ 1rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.71-2.5.3.1.el7_0.x86_64 3ã€å®‰è£…jdk 1sudo tar -zxvf yourjdk.tar.gz -C /usr/lib 4ã€é…ç½®JDKçŽ¯å¢ƒå˜é‡ 1234export JAVA_HOME=/usr/lib/jdk1.8.0_92export JRE_HOME=$&#123;JAVA_HOME&#125;/jreexport PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/binexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib 5ã€ä¸ºäº†ä½¿ç¼–è¯‘ç”Ÿæ•ˆ 1source /etc/profile 6ã€æŸ¥çœ‹pathå€¼ 1echo $PATH Macå®˜ç½‘ä¸‹è½½dmgç‰ˆæœ¬å®‰è£…åŽé…ç½®çŽ¯å¢ƒå¦‚ä¸‹ 1sudo vim ~/.bash_profile]]></content>
      <categories>
        <category>JAVA</category>
        <category>config</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2017%2F09%2F07%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
</search>
