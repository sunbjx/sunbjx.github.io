<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ç†è§£æ¶ˆæ¯é€šä¿¡ä¹‹RabbitMQ]]></title>
    <url>%2F2017%2F09%2F26%2F%E7%90%86%E8%A7%A3%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1%E4%B9%8BRabbitMQ%2F</url>
    <content type="text"><![CDATA[æ¶ˆè´¹è€…å’Œç”Ÿäº§è€… RabbitMQ åœ¨åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨ä¹‹é—´æ‰®æ¼”ç€è·¯ç”±å™¨ç­‰è§’è‰²ã€‚æ‰€ä»¥å½“åº”ç”¨ç¨‹åºè¿žæŽ¥åˆ°RabbitMQ æ—¶ï¼Œå®ƒå°±å¿…é¡»åšä¸ªå†³å®šï¼šæˆ‘æ˜¯åœ¨å‘é€è¿˜æ˜¯æŽ¥æ”¶å‘¢ï¼Ÿæˆ–è€…ä»ŽAMQPçš„è§’åº¦æ€è€ƒï¼Œæˆ‘æ˜¯ä¸€ä¸ªç”Ÿäº§è€…è¿˜æ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…å‘¢ï¼Ÿ ç”Ÿäº§è€…(producer)åˆ›å»ºæ¶ˆæ¯ï¼Œç„¶åŽå‘å¸ƒ(å‘é€)åˆ°ä»£ç†æœåŠ¡å™¨(RabbitMQ ). ä»€ä¹ˆæ˜¯æ¶ˆæ¯ æ¶ˆæ¯åŒ…å«ä¸¤éƒ¨åˆ†ï¼šæœ‰æ•ˆè·è½½ï¼ˆpayloadï¼‰å’Œæ ‡ç­¾ï¼ˆlabelï¼‰ æœ‰æ•ˆè·è½½å°±æ˜¯ä½ æƒ³è¦ä¼ è¾“çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•å†…å®¹ã€‚æ ‡ç­¾è¡¨è¿°äº†æœ‰æ•ˆè·è½½ï¼Œå¹¶ä¸”RabbitMQ ç”¨å®ƒæ¥å†³å®šè°å°†èŽ·å¾—æ¶ˆæ¯çš„æ‹·è´é¦–å…ˆè¿žæŽ¥åˆ°Rabbit ï¼Œæ‰èƒ½æ¶ˆè´¹æˆ–è€…å‘å¸ƒæ¶ˆæ¯ã€‚ä½ åœ¨åº”ç”¨ç¨‹åºå’ŒRabbit ä»£ç†æœåŠ¡å™¨ä¹‹é—´åˆ›å»ºä¸€æ¡TCPè¿žæŽ¥ã€‚ä¸€æ—¦TCPè¿žæŽ¥æ‰“å¼€ï¼ˆä½ é€šè¿‡äº†è®¤è¯ï¼‰ï¼Œåº”ç”¨ç¨‹åºå°±å¯ä»¥åˆ›å»ºä¸€æ¡AMQPä¿¡é“ã€‚ ä»€ä¹ˆæ˜¯ä¿¡é“ ä¿¡é“æ˜¯å»ºç«‹åœ¨â€œçœŸå®žçš„â€TCPè¿žæŽ¥å†…çš„è™šæ‹Ÿè¿žæŽ¥ã€‚AMQPå‘½ä»¤éƒ½æ˜¯é€šè¿‡ä¿¡é“å‘é€å‡ºåŽ»çš„ã€‚æ¯æ¡ä¿¡é“éƒ½ä¼šæŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„IDï¼ˆAMQPåº“ä¼šå¸®ä½ è®°ä½IDçš„ï¼‰ä¸è®ºæ˜¯å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…é˜Ÿåˆ—æˆ–æ˜¯æŽ¥æ”¶æ¶ˆæ¯ï¼Œè¿™äº›åŠ¨ä½œéƒ½æ˜¯é€šè¿‡ä¿¡é“å®Œæˆçš„ã€‚ çº¿ç¨‹å¯åŠ¨åŽï¼Œä¼šåœ¨çŽ°æˆçš„è¿žæŽ¥ä¸Šåˆ›å»ºä¸€æ¡ä¿¡é“ï¼Œä¹Ÿå°±èŽ·å¾—äº†è¿žæŽ¥åˆ°Rabbit ä¸Šçš„ç§å¯†é€šä¿¡è·¯å¾„ï¼Œè€Œä¸ä¼šç»™æ“ä½œç³»ç»Ÿçš„TCPé€ æˆé¢å¤–çš„è´Ÿæ‹…ã€‚åœ¨ä¸€æ¡TCPè¿žæŽ¥ä¸Šåˆ›å»ºå¤šå°‘æ¡ä¿¡é“æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ AMQP TCPè¿žæŽ¥å°±åƒç”µç¼†ï¼Œè€ŒAMQPä¿¡é“å°±åƒä¸€æ¡æ¡ç‹¬ç«‹å…‰çº¤æŸã€‚ AMQPæ¶ˆæ¯è·¯ç”±å¿…é¡»æœ‰ä¸‰éƒ¨åˆ†ï¼šäº¤æ¢å™¨ã€é˜Ÿåˆ—å’Œç»‘å®šã€‚ç”Ÿäº§è€…æŠŠæ¶ˆæ¯å‘å¸ƒåˆ°äº¤æ¢å™¨ä¸Šï¼›æ¶ˆæ¯æœ€ç»ˆè¾¾åˆ°é˜Ÿåˆ—ï¼Œå¹¶è¢«æ¶ˆè´¹è€…æŽ¥æ”¶ï¼›ç»‘å®šå†³å®šäº†æ¶ˆæ¯å¦‚ä½•ä»Žè·¯ç”±å™¨è·¯ç”±åˆ°ç‰¹å®šçš„é˜Ÿåˆ—ã€‚ AMQP messaging ä¸­çš„åŸºæœ¬æ¦‚å¿µ Broker: æŽ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯Message Brokerã€‚ Virtual host: å‡ºäºŽå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠAMQPçš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºŽç½‘ç»œä¸­çš„namespaceæ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªRabbitMQ serveræä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„vhoståˆ›å»ºexchangeï¼queueç­‰ã€‚ Connection: publisherï¼consumerå’Œbrokerä¹‹é—´çš„TCPè¿žæŽ¥ã€‚æ–­å¼€è¿žæŽ¥çš„æ“ä½œåªä¼šåœ¨clientç«¯è¿›è¡Œï¼ŒBrokerä¸ä¼šæ–­å¼€è¿žæŽ¥ï¼Œé™¤éžå‡ºçŽ°ç½‘ç»œæ•…éšœæˆ–brokeræœåŠ¡å‡ºçŽ°é—®é¢˜ã€‚ Channel: å¦‚æžœæ¯ä¸€æ¬¡è®¿é—®RabbitMQéƒ½å»ºç«‹ä¸€ä¸ªConnectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹TCP Connectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆçŽ‡ä¹Ÿè¾ƒä½Žã€‚Channelæ˜¯åœ¨connectionå†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿žæŽ¥ï¼Œå¦‚æžœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„channelè¿›è¡Œé€šè®¯ï¼ŒAMQP methodåŒ…å«äº†channel idå¸®åŠ©å®¢æˆ·ç«¯å’Œmessage brokerè¯†åˆ«channelï¼Œæ‰€ä»¥channelä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channelä½œä¸ºè½»é‡çº§çš„Connectionæžå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹TCP connectionçš„å¼€é”€ã€‚ Exchange: messageåˆ°è¾¾brokerçš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ°queueä¸­åŽ»ã€‚å¸¸ç”¨çš„ç±»åž‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast)ã€‚ Queue: æ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾…consumerå–èµ°ã€‚ä¸€ä¸ªmessageå¯ä»¥è¢«åŒæ—¶æ‹·è´åˆ°å¤šä¸ªqueueä¸­ã€‚ Binding: exchangeå’Œqueueä¹‹é—´çš„è™šæ‹Ÿè¿žæŽ¥ï¼Œbindingä¸­å¯ä»¥åŒ…å«routing keyã€‚Bindingä¿¡æ¯è¢«ä¿å­˜åˆ°exchangeä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äºŽmessageçš„åˆ†å‘ä¾æ®ã€‚ å…¸åž‹çš„â€œç”Ÿäº§ï¼æ¶ˆè´¹â€æ¶ˆæ¯æ¨¡åž‹ ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°broker serverï¼ˆRabbitMQï¼‰ã€‚åœ¨Brokerå†…éƒ¨ï¼Œç”¨æˆ·åˆ›å»ºExchangeï¼Queueï¼Œé€šè¿‡Bindingè§„åˆ™å°†ä¸¤è€…è”ç³»åœ¨ä¸€èµ·ã€‚Exchangeåˆ†å‘æ¶ˆæ¯ï¼Œæ ¹æ®ç±»åž‹ï¼bindingçš„ä¸åŒåˆ†å‘ç­–ç•¥æœ‰åŒºåˆ«ã€‚æ¶ˆæ¯æœ€åŽæ¥åˆ°Queueä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å–èµ°ã€‚ æ¶ˆæ¯å¦‚ä½•è¾¾åˆ°é˜Ÿåˆ— å½“ä½ æƒ³è¦å°†æ¶ˆæ¯æŠ•é€’åˆ°é˜Ÿåˆ—æ—¶ï¼Œä½ é€šè¿‡æŠŠæ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨æ¥å®Œæˆã€‚ç„¶åŽæ ¹æ®ç¡®å®šçš„è§„åˆ™ï¼ŒRabbitMQ å°†ä¼šå†³å®šæ¶ˆæ¯è¯¥æŠ•é€’åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚è¿™äº›è§„åˆ™è¢«ç§°ä¸ºè·¯ç”±é”®ï¼ˆrouting keyï¼‰ã€‚ é˜Ÿåˆ—é€šè¿‡è·¯ç”±é”®ç»‘å®šåˆ°äº¤æ¢å™¨ã€‚å½“ä½ æŠŠæ¶ˆæ¯å‘é€åˆ°ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œæ¶ˆæ¯å°†æ‹¥æœ‰ä¸€ä¸ªè·¯ç”±é”®ï¼ˆå³ä¾¿æ—¶ç©ºçš„ï¼‰RabbitMQ ä¹Ÿä¼šå°†å…¶å’Œç»‘å®šä½¿ç”¨çš„è·¯ç”±é”®è¿›è¡ŒåŒ¹é…ã€‚å¦‚æžœåŒ¹é…ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šæŠ•é€’åˆ°è¯¥é˜Ÿåˆ—ï¼Œå¦‚æžœè·¯ç”±çš„æ¶ˆæ¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šæ¨¡å¼çš„è¯ï¼Œæ¶ˆæ¯å°†è¿›å…¥â€œé»‘æ´žâ€ã€‚ æœåŠ¡å™¨ä¼šæ ¹æ®è·¯ç”±é”®å°†æ¶ˆæ¯ä»Žäº¤æ¢å™¨è·¯ç”±åˆ°é˜Ÿåˆ—ï¼Œä½†å®ƒæ˜¯å¦‚ä½•å¤„ç†æŠ•é€’åˆ°å¤šä¸ªé˜Ÿåˆ—çš„æƒ…å†µçš„å‘¢ï¼Ÿ åè®®ä¸­å®šä¹‰çš„å››ç§ç±»åž‹äº¤æ¢æœºï¼šdirectã€fanoutã€topicã€headersã€‚ Exchangeç±»åž‹Exchangeæœ‰å¤šç§ç±»åž‹ï¼Œæœ€å¸¸ç”¨çš„æ˜¯Directï¼Fanoutï¼Topicä¸‰ç§ç±»åž‹ã€‚ Direct Messageä¸­çš„â€œrouting keyâ€å¦‚æžœå’ŒBindingä¸­çš„â€œbinding keyâ€ä¸€è‡´ï¼Œ Direct exchangeåˆ™å°†messageå‘åˆ°å¯¹åº”çš„queueä¸­ã€‚ Fanout æ¯ä¸ªå‘åˆ°Fanoutç±»åž‹Exchangeçš„messageéƒ½ä¼šåˆ†åˆ°æ‰€æœ‰ç»‘å®šçš„queueä¸ŠåŽ»ã€‚ Topic æ ¹æ®routing keyï¼ŒåŠé€šé…è§„åˆ™ï¼ŒTopic exchangeå°†åˆ†å‘åˆ°ç›®æ ‡queueä¸­ã€‚ Routing keyä¸­å¯ä»¥åŒ…å«ä¸¤ç§é€šé…ç¬¦ï¼Œç±»ä¼¼äºŽæ­£åˆ™è¡¨è¾¾å¼ï¼š â€œ#â€é€šé…ä»»ä½•é›¶ä¸ªæˆ–å¤šä¸ªword â€œ*â€é€šé…ä»»ä½•å•ä¸ªword æ¶ˆè´¹è€…é€šè¿‡ä¸€ä¸‹ä¸¤ç§æ–¹å¼ä»Žç‰¹å®šçš„é˜Ÿåˆ—ä¸­æŽ¥æ”¶æ¶ˆæ¯ é€šè¿‡AMQPçš„basic.consumeå‘½ä»¤è®¢é˜…ã€‚è¿™æ ·åšä¼šå°†ä¿¡é“è®¾ç½®ä¸ºæŽ¥æ”¶æ¨¡å¼ï¼Œç›´åˆ°å–æ¶ˆé˜Ÿåˆ—çš„è®¢é˜…ä¸ºæ­¢ã€‚è®¢é˜…äº†æ¶ˆæ¯åŽï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹ï¼ˆæˆ–è€…æ‹’ç»ï¼‰æœ€è¿‘æŽ¥æ”¶çš„é‚£æ¡æ¶ˆæ¯åŽï¼Œå°±èƒ½ä»Žé˜Ÿåˆ—ä¸­ï¼ˆå¯ç”¨çš„ï¼‰è‡ªåŠ¨æŽ¥æ”¶ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚ æŸäº›æ—¶å€™ï¼Œä½ åªæƒ³ä»Žé˜Ÿåˆ—èŽ·å¾—å•æ¡æ¶ˆæ¯è€Œä¸æ˜¯æŒç»­è®¢é˜…ã€‚å‘é˜Ÿåˆ—è¯·æ±‚å•æ¡æ¶ˆæ¯æ˜¯é€šè¿‡AMQPçš„basic.getå‘½ä»¤å®žçŽ°çš„ã€‚å¦‚æžœè¦èŽ·å¾—æ›´å¤šçš„æ¶ˆæ¯ï¼Œéœ€è¦å†æ¬¡å‘é€basic.getå‘½ä»¤ã€‚ æ¶ˆè´¹è€…ç†åº”å§‹ç»ˆä½¿ç”¨basic.consumeæ¥å®žçŽ°é«˜åžåé‡ã€‚ å¦‚æžœè‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…äº†é˜Ÿåˆ—çš„è¯ï¼Œæ¶ˆæ¯ä¼šç«‹å³å‘é€ç»™è¿™äº›è®¢é˜…çš„æ¶ˆè´¹è€…ã€‚ å¦‚æžœæ¶ˆæ¯åˆ°è¾¾äº†æ— äººè®¢é˜…çš„é˜Ÿåˆ—çš„è¯ï¼Œæ¶ˆæ¯ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œä¸€æ—¦æœ‰æ¶ˆè´¹è€…è®¢é˜…åˆ°è¯¥é˜Ÿåˆ—ï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯å°±ä¼šå‘é€ç»™æ¶ˆè´¹è€…ã€‚ å¦‚æžœæœ‰å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åˆ°åŒä¸€é˜Ÿåˆ—ä¸Šæ—¶ï¼Œæ¶ˆæ¯å¦‚ä½•åˆ†å‘ï¼š å½“Rabbité˜Ÿåˆ—æ‹¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œé˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯å°†ä»¥å¾ªçŽ¯çš„æ–¹å¼å‘é€ç»™æ¶ˆè´¹è€…ã€‚æ¯æ¡æ¶ˆæ¯åªä¼šå‘é€ç»™ä¸€ä¸ªè®¢é˜…çš„æ¶ˆè´¹è€…ã€‚ å‡è®¾æœ‰seed_biné˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€… A å’Œæ¶ˆè´¹è€… Bè®¢é˜…åˆ°seed_biné˜Ÿåˆ—ã€‚å½“æ¶ˆæ¯è¾¾åˆ°seed_biné˜Ÿåˆ—æ—¶ï¼Œæ¶ˆæ¯æŠ•é€’æ–¹å¼å¦‚ä¸‹ï¼š 1ã€æ¶ˆæ¯message_a è¾¾åˆ° seed_bin é˜Ÿåˆ— 2ã€RabbitMQ æŠŠæ¶ˆæ¯message_a å‘é€ç»™A 3ã€Aç¡®è®¤æŽ¥æ”¶åˆ°äº†æ¶ˆæ¯message_a 4ã€RabbitMQ æŠŠæ¶ˆæ¯message_aä»Žseed_binä¸­åˆ é™¤ 5ã€æ¶ˆæ¯message_bè¾¾åˆ°seed_biné˜Ÿåˆ— 6ã€RabbitMQ æŠŠæ¶ˆæ¯messages_bå‘é€ç»™B 7ã€Bç¡®è®¤æŽ¥æ”¶åˆ°äº†æ¶ˆæ¯message_b 8ã€RabbitMQ æŠŠæ¶ˆæ¯message_bä»Žseed_binä¸­åˆ é™¤ ACK æ¶ˆæ¯ç¡®è®¤ æ¶ˆè´¹è€…æŽ¥æ”¶åˆ°çš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½å¿…é¡»è¿›è¡Œç¡®è®¤ã€‚æ¶ˆè´¹è€…å¿…é¡»é€šè¿‡AMQPçš„basic.ackå‘½ä»¤æ˜¾å¼åœ°å‘RabbitMQ å‘é€ä¸€ä¸ªç¡®è®¤ï¼Œæˆ–è€…åœ¨è®¢é˜…åˆ°é˜Ÿåˆ—çš„æ—¶å€™å°†basic.ackå‚æ•°è®¾ç½®ä¸ºtrueã€‚ æ¶ˆè´¹è€…é€šè¿‡ç¡®è®¤å‘½ä»¤å‘Šè¯‰RabbitMQ å®ƒå·²ç»æ­£ç¡®åœ°æŽ¥æ”¶äº†æ¶ˆæ¯ï¼ŒåŒæ—¶RabbitMQ æ‰èƒ½å®‰å…¨åœ°æŠŠæ¶ˆæ¯ä»Žé˜Ÿåˆ—ä¸­åˆ é™¤ã€‚ å¦‚æžœæ¶ˆè´¹è€…æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åŽç¡®è®¤ä¹‹å‰ä»ŽRabbitæ–­å¼€è¿žæŽ¥ï¼ˆæˆ–è€…ä»Žé˜Ÿåˆ—ä¸Šå–æ¶ˆè®¢é˜…ï¼‰ï¼ŒRabbitMQ ä¼šè®¤ä¸ºè¿™æ¡æ¶ˆæ¯æ²¡æœ‰åˆ†å‘ï¼Œç„¶åŽé‡æ–°åˆ†å‘ç»™ä¸‹ä¸€ä¸ªè®¢é˜…çš„æ¶ˆè´¹è€…ã€‚ å¦‚æžœåº”ç”¨ç¨‹åºæœ‰bugè€Œå¿˜è®°ç¡®è®¤æ¶ˆæ¯çš„è¯ï¼ŒRabbitå°†ä¸ä¼šç»™è¯¥æ¶ˆè´¹è€…å‘é€æ›´å¤šæ¶ˆæ¯äº†ã€‚ åªè¦æ¶ˆæ¯å°šæœªç¡®è®¤ï¼Œåˆ™æœ‰ä»¥ä¸‹ä¸¤ä¸ªé€‰æ‹©ï¼š æŠŠæ¶ˆè´¹è€…ä»ŽRabbitMQ æœåŠ¡å™¨æ–­å¼€è¿žæŽ¥ã€‚ ä½¿ç”¨AMQPçš„basic.rejectå‘½ä»¤ Aã€å¦‚æžœæŠŠrejectå‘½ä»¤çš„requeueå‚æ•°è®¾ç½®æˆtrueï¼ŒRabbitMQ ä¼šå°†æ¶ˆæ¯é‡æ–°å‘é€ç»™ä¸‹ä¸€ä¸ªæ¶ˆ è´¹è€…ï¼Œ Bã€å¦‚æžœè®¾ç½®æˆfalseï¼ŒRabbitMQ ç«‹å³ä¼šæŠŠæ¶ˆæ¯ä»Žé˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œè€Œä¸ä¼šæŠŠå®ƒå‘é€ç»™æ–°çš„æ¶ˆè´¹è€…ã€‚ é˜Ÿåˆ—åˆ›å»ºé˜Ÿåˆ—ï¼šæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…éƒ½èƒ½ä½¿ç”¨AMQPçš„queue.declareå‘½ä»¤æ¥åˆ›å»ºé˜Ÿåˆ—ã€‚ä½†æ˜¯å¦‚æžœæ¶ˆè´¹è€…åœ¨åŒä¸€æ¡ä¿¡é“ä¸Šè®¢é˜…äº†å¦ä¸€ä¸ªé˜Ÿåˆ—çš„è¯ï¼Œå°±æ— æ³•å†å£°æ˜Žé˜Ÿåˆ—äº†ã€‚å¿…é¡»å…ˆå–æ¶ˆè®¢é˜…ï¼Œå°†ä¿¡é“è®¾ç½®ä¸ºâ€œä¼ è¾“â€æ¨¡å¼ã€‚ å®žç”¨å‚æ•°ï¼š exclusive å¦‚æžœè®¾ç½®ä¸ºtrueï¼Œé˜Ÿåˆ—å°†å˜æˆç§æœ‰çš„ï¼Œæ­¤æ—¶åªæœ‰ä½ çš„åº”ç”¨ç¨‹åºæ‰èƒ½å¤Ÿæ¶ˆè´¹é˜Ÿåˆ—æ¶ˆæ¯ã€‚ auto-delete å½“æœ€åŽä¸€ä¸ªæ¶ˆè´¹è€…å–æ¶ˆè®¢é˜…æ—¶ï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨ç§»é™¤ã€‚ æ£€æµ‹é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨ï¼šå°†queue.declareçš„passiveé€‰é¡¹ä¸ºtrue å¦‚æžœé˜Ÿåˆ—å­˜åœ¨ï¼Œé‚£ä¹ˆqueue.declareå‘½ä»¤ä¼šæˆåŠŸè¿”å›ž å¦‚æžœé˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œqueue.declareå‘½ä»¤ä¸ä¼šåˆ›å»ºé˜Ÿåˆ—è€Œä¼šè¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ é˜Ÿåˆ—æ˜¯AMQPæ¶ˆæ¯é€šä¿¡çš„åŸºç¡€æ¨¡å—ï¼š ä¸ºæ¶ˆæ¯æä¾›äº†å¤„æ‰€ï¼Œæ¶ˆæ¯åœ¨æ­¤ç­‰å¾…æ¶ˆè´¹ å¯¹è´Ÿè½½å‡è¡¡æ¥è¯´ï¼Œé˜Ÿåˆ—æ˜¯ç»ä½³æ–¹æ¡ˆï¼Œåªéœ€é™„åŠ ä¸€å †æ¶ˆè´¹è€…ï¼Œå¹¶è®©RabbitMQ ä»¥å¾ªçŽ¯çš„æ–¹å¼å‡åŒ€çš„åˆ†é…å‘æ¥çš„æ¶ˆæ¯ã€‚ é˜Ÿåˆ—æ˜¯Rabbitä¸­æ¶ˆæ¯çš„ç»ˆç‚¹ï¼ˆé™¤éžæ¶ˆæ¯è¿›å…¥äº†â€œé»‘æ´žâ€ï¼‰ æœåŠ¡å™¨å¿…é¡»å®žçŽ°directç±»åž‹äº¤æ¢å™¨ï¼ŒåŒ…å«ä¸€ä¸ªç©ºç™½å­—ç¬¦ä¸²åç§°çš„é»˜è®¤äº¤æ¢å™¨ã€‚å½“å£°æ˜Žä¸€ä¸ªé˜Ÿåˆ—æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç»‘å®šåˆ°é»˜è®¤äº¤æ¢å™¨ï¼Œå¹¶ä»¥é˜Ÿåˆ—åç§°åšä¸ºè·¯ç”±é”®ã€‚ å¤šç§Ÿæˆ·æ¨¡å¼ï¼šè™šæ‹Ÿä¸»æœºå’Œéš”ç¦» æ¯ä¸€ä¸ªRabbitMQ æœåŠ¡å™¨éƒ½èƒ½åˆ›å»ºè™šæ‹Ÿæ¶ˆæ¯æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰. vhostä¹‹äºŽRabbitå°±åƒè™šæ‹Ÿæœºä¹‹äºŽç‰©ç†æœåŠ¡å™¨ä¸€æ ·ã€‚ å½“åœ¨RabbitMQ é›†ç¾¤ä¸Šåˆ›å»ºvhostæ—¶ï¼Œæ•´ä¸ªé›†ç¾¤ä¸Šéƒ½ä¼šåˆ›å»ºè¯¥vhostã€‚ æ¶ˆæ¯æŒä¹…åŒ–é‡å¯RabbitMQ æœåŠ¡å™¨åŽï¼Œé‚£äº›é˜Ÿåˆ—å’Œäº¤æ¢å™¨å°±éƒ½æ¶ˆå¤±äº†ã€‚åŽŸå› åœ¨äºŽæ¯ä¸ªé˜Ÿåˆ—å’Œäº¤æ¢å™¨çš„durableå±žæ€§ã€‚ è¯¥å±žæ€§é»˜è®¤æƒ…å†µä¸ºfalseï¼Œå®ƒå†³å®šäº†RabbitMQ æ˜¯å¦éœ€è¦åœ¨å´©æºƒæˆ–è€…é‡å¯ä¹‹åŽé‡æ–°åˆ›å»ºé˜Ÿåˆ—æˆ–è€…äº¤æ¢å™¨ã€‚ è®¾ç½®ä¸ºtrueï¼Œå°±ä¸éœ€è¦åœ¨æœåŠ¡å™¨æ–­ç”µåŽé‡æ–°åˆ›å»ºé˜Ÿåˆ—å’Œäº¤æ¢å™¨äº†ã€‚ èƒ½ä»ŽAMQPæœåŠ¡å™¨å´©æºƒä¸­æ¢å¤çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæŒä¹…åŒ–æ¶ˆæ¯ã€‚ åœ¨æ¶ˆæ¯å‘å¸ƒå‰ï¼Œé€šè¿‡æŠŠå®ƒçš„â€œæŠ•é€’æ¨¡å¼â€ï¼ˆdelivery modeï¼‰é€‰é¡¹è®¾ç½®ä¸º 2æ¥æŠŠæ¶ˆæ¯æ ‡è®°æˆæŒä¹…åŒ–ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ¶ˆæ¯è¿˜åªæ˜¯è¢«è¡¨ç¤ºä¸ºæŒä¹…åŒ–çš„ï¼Œä½†æ˜¯å®ƒè¿˜å¿…é¡»è¢«å‘å¸ƒåˆ°æŒä¹…åŒ–çš„äº¤æ¢å™¨ä¸­å¹¶åˆ°è¾¾æŒä¹…åŒ–çš„é˜Ÿåˆ—ä¸­æ‰è¡Œã€‚ æ¶ˆæ¯è¦ä»ŽRabbitå´©æºƒä¸­æ¢å¤ æŠŠå®ƒçš„æŠ•é€’æ¨¡å¼é€‰é¡¹è®¾ç½®ä¸º2ï¼ˆæŒä¹…ï¼‰ å‘é€åˆ°æŒä¹…åŒ–çš„äº¤æ¢å™¨ åˆ°è¾¾æŒä¹…åŒ–é˜Ÿåˆ— RabbitMQ ç¡®ä¿æŒä¹…æ€§æ¶ˆæ¯èƒ½ä»ŽæœåŠ¡å™¨é‡å¯ä¸­æ¢å¤çš„æ–¹å¼æ˜¯ï¼Œå°†å®ƒä»¬å†™å…¥ç£ç›˜ä¸Šçš„ä¸€ä¸ªæŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶ã€‚å½“å‘å¸ƒä¸€æ¡æŒä¹…æ€§æ¶ˆæ¯åˆ°æŒä¹…äº¤æ¢å™¨ä¸Šæ—¶ï¼ŒRabbitæ¶ˆæ¯ä¼šåœ¨æ¶ˆæ¯æäº¤åˆ°æ—¥å¿—æ–‡ä»¶åŽæ‰å‘é€å“åº”ã€‚ æ³¨æ„ï¼š ä¹‹åŽè¿™æ¡æ¶ˆæ¯å¦‚æžœè·¯ç”±åˆ°äº†éžæŒä¹…é˜Ÿåˆ—çš„è¯ï¼Œå®ƒä¼šè‡ªåŠ¨ä»ŽæŒä¹…æ€§æ—¥å¿—ä¸­ç§»é™¤ï¼Œå¹¶ä¸”æ— æ³•ä»ŽæœåŠ¡å™¨é‡å¯ä¸­æ¢å¤ã€‚ ä¸€æ—¦ä»ŽæŒä¹…åŒ–é˜Ÿåˆ—ä¸­æ¶ˆè´¹äº†ä¸€æ¡æŒä¹…æ€§æ¶ˆæ¯åˆ°è¯ï¼ˆå¹¶ä¸”ç¡®è®¤äº†å®ƒï¼‰ï¼ŒRabbitMQ ä¼šåœ¨æŒä¹…åŒ–æ—¥å¿—ä¸­æŠŠè¿™æ¡æ¶ˆæ¯æ ‡è®°ä¸ºç­‰å¾…åžƒåœ¾æ”¶é›†ã€‚ æƒè¡¡å–èˆï¼Œä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨æŒä¹…åŒ–æ¶ˆæ¯é€šä¿¡ï¼š åˆ†æžå¹¶æµ‹è¯•æ€§èƒ½éœ€æ±‚ æ˜¯å¦éœ€è¦å•å°RabbitæœåŠ¡å™¨æ¯ç§’å¤„ç†10 0000 æ¡æ¶ˆæ¯ å‘é€æ–¹ç¡®è®¤æ¨¡å¼éœ€è¦å‘Šè¯‰Rabbitå°†ä¿¡é“è®¾ç½®æˆconfirmæ¨¡å¼ï¼Œè€Œä¸”åªèƒ½é€šè¿‡é‡æ–°åˆ›å»ºä¿¡é“æ¥å…³é—­è¯¥è®¾ç½®ã€‚ ä¸€æ—¦ä¿¡é“è¿›å…¥confirmæ¨¡å¼ï¼Œæ‰€æœ‰åœ¨ä¿¡é“ä¸Šå‘å¸ƒçš„æ¶ˆæ¯éƒ½ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„IDå·ï¼ˆä»Ž 1 å¼€å§‹ï¼‰ã€‚ ä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’ç»™æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—åŽï¼Œä¿¡é“ä¼šå‘é€ä¸€ä¸ªå‘é€æ–¹ç¡®è®¤æ¨¡å¼ç»™ç”Ÿäº§è€…åº”ç”¨ç¨‹åºï¼ˆåŒ…å«æ¶ˆæ¯çš„å”¯ä¸€IDï¼‰è¿™ä½¿å¾—ç”Ÿäº§è€…çŸ¥æ™“æ¶ˆæ¯å·²ç»å®‰å…¨åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†ã€‚ å¦‚æžœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯åªä¼šåœ¨é˜Ÿåˆ—å°†æ¶ˆæ¯å†™å…¥ç£ç›˜åŽæ‰ä¼šå‘å‡ºã€‚ å‘é€æ–¹ç¡®è®¤æ¨¡å¼æœ€å¤§çš„å¥½å¤„æ˜¯å®ƒä»¬æ˜¯å¼‚æ­¥ çš„ã€‚ äºŽ ã€ŠRabbitMQå®žæˆ˜ã€‹æŠ„å½•]]></content>
      <categories>
        <category>middleware</category>
        <category>RabbitMQ</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[dockerç§æœ‰ä»“åº“ä¹‹Nexus3]]></title>
    <url>%2F2017%2F09%2F25%2Fdocker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E4%B9%8BNexus3%2F</url>
    <content type="text"><![CDATA[èŽ·å–Nexusçš„Dockeré•œåƒDocker hub -nexus 1$ docker pull sonatype/nexus3 å®¹å™¨è¿è¡ŒNexus12$ mkdir -p /data/nexus-data &amp;&amp; chown -R 200 /data/nexus-data$ docker run -d -p 8081-8100:8081-8100 --name nexus -v /data/nexus-data:/nexus-data sonatype/nexus3 åˆ›å»ºDockerç§æœ‰ä»“åº“ é»˜è®¤è´¦æˆ· admin å¯†ç  admin123ï¼Œç™»å½•å¦‚ä¸‹ åœ¨è®¾ç½® Repositories é€‰é¡¹å¡ä¸­ä¸­é€‰æ‹© Create repository é€‰æ‹©hosted hosted: æœ¬åœ°å­˜å‚¨ï¼Œå³åŒ docker å®˜æ–¹ä»“åº“ä¸€æ ·æä¾›æœ¬åœ°ç§æœåŠŸèƒ½ proxy: æä¾›ä»£ç†å…¶ä»–ä»“åº“çš„ç±»åž‹ï¼Œå¦‚ docker ä¸­å¤®ä»“åº“ group: ç»„ç±»åž‹ï¼Œå®žè´¨ä½œç”¨æ˜¯ç»„åˆå¤šä¸ªä»“åº“ä¸ºä¸€ä¸ªåœ°å€ é€‰æ‹© hosted ç±»åž‹ä»“åº“ï¼Œç„¶åŽè¾“å…¥ä¸€ä¸ªä»“åº“åï¼Œå¹¶å‹¾é€‰ HTTP é€‰é¡¹ï¼Œç«¯å£ä»»æ„å³å¯ æµ‹è¯•ç§æœ æµ‹è¯• push å’Œ pull é•œåƒ 12345678910111213141516171819202122docker tag sunbjx/alpine registry.com:8082/alpineâžœ ~ docker push registry.com:8082/alpineThe push refers to a repository [registry.com:8082/alpine]754684812d65: Pushed60ab55d3379d: Pushedlatest: digest: sha256:28f397aca53eb3e8ea1627f4af9c262fca7db17f0c6db492b53adc7bca7d0f91 size: 739âžœ ~ docker rmi registry.com:8082/alpineUntagged: registry.com:8082/alpine:latestUntagged: registry.com:8082/alpine@sha256:28f397aca53eb3e8ea1627f4af9c262fca7db17f0c6db492b53adc7bca7d0f91âžœ ~ docker rmi sunbjx/alpineUntagged: sunbjx/alpine:latestUntagged: sunbjx/alpine@sha256:28f397aca53eb3e8ea1627f4af9c262fca7db17f0c6db492b53adc7bca7d0f91Deleted: sha256:090c790ee6f28f495d92d5be43641573b0d1b5502b35f7662d88cdbf8d548afdDeleted: sha256:378e2b887fcdffcbd113a7cf6f97e9f8a58851b0a205b31a93acdb887912850dâžœ ~ docker pull registry.com:8082/alpineUsing default tag: latestlatest: Pulling from alpine0a8490d0dfd3: Already exists8fb018fb4173: Pull completeDigest: sha256:28f397aca53eb3e8ea1627f4af9c262fca7db17f0c6db492b53adc7bca7d0f91Status: Downloaded newer image for registry.com:8082/alpine:latest]]></content>
      <categories>
        <category>devops</category>
        <category>docker</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[CentOS7æºç å®‰è£…mysql5.6(ç¤¾åŒºç‰ˆ)]]></title>
    <url>%2F2017%2F09%2F25%2FCentOS7%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85mysql5-6-%E7%A4%BE%E5%8C%BA%E7%89%88%2F</url>
    <content type="text"><![CDATA[ç¡®è®¤å®‰è£…ç‰ˆæœ¬mysqlåˆ†ä¸ºå¼€å‘ç‰ˆæœ¬å’Œç¨³å®šç‰ˆæœ¬ï¼ˆGAï¼‰ï¼Œå¼€å‘ç‰ˆæœ¬æ‹¥æœ‰æœ€æ–°çš„ç‰¹æ€§ï¼Œä½†æ˜¯å¹¶ä¸ç¨³å®šï¼Œä¹Ÿæ²¡æœ‰å®Œå…¨ç»è¿‡æµ‹è¯•ï¼Œå¯èƒ½å­˜åœ¨ä¸¥é‡çš„bugï¼Œè€Œç¨³å®šç‰ˆæœ¬æ˜¯ç»è¿‡äº†é•¿æ—¶é—´çš„æµ‹è¯•ï¼Œæ¶ˆé™¤äº†å…·æœ‰å·²çŸ¥çš„bugï¼Œå…¶ç¨³å®šæ€§å’Œå®‰å…¨æ€§éƒ½å¾—åˆ°ä¸€å®šçš„ä¿éšœã€‚ å¯¹äºŽä¸€ä¸ªmysqlçš„ç‰ˆæœ¬å·å¦‚ï¼šmysql-5.6.1-m1ï¼Œè¿™ä¸ªç‰ˆæœ¬å·æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ å¯¹äºŽ5.6.1çš„è§£é‡Šï¼šç¬¬ä¸€ä¸ªæ•°å­—5ä»£è¡¨äº†æ–‡ä»¶æ ¼å¼ï¼Œç¬¬äºŒä¸ªæ•°å­—6ä»£è¡¨äº†å‘è¡Œçº§åˆ«ï¼Œç¬¬ä¸‰ä¸ªæ•°å­—1ä»£è¡¨äº†ç‰ˆæœ¬å·ã€‚æ›´æ–°å¹…åº¦è¾ƒå°æ—¶ï¼Œæœ€åŽçš„æ•°å­—ä¼šå¢žåŠ ï¼Œå‡ºçŽ°äº†é‡å¤§ç‰¹æ€§æ›´æ–°æ—¶ï¼Œç¬¬äºŒä¸ªæ•°å­—ä¼šå¢žåŠ ï¼Œæ–‡ä»¶æ ¼å¼æ”¹å˜æ—¶ï¼Œç¬¬ä¸€ä¸ªæ•°å­—ä¼šå¢žåŠ  å¯¹äºŽm1çš„è§£é‡Šï¼šè¿™æ˜¯ç”¨æ¥è¡¨æ˜Žè¿™ä¸ªmysqlç‰ˆæœ¬çš„ç¨³å®šæ€§çº§åˆ«çš„ï¼Œå¦‚æžœæ²¡æœ‰è¿™ä¸ªåŽç¼€ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰ˆæœ¬å°±æ˜¯ä¸€ä¸ªç¨³å®šç‰ˆï¼ˆGAï¼‰ï¼›å¦‚æžœè¿™ä¸ªåŽç¼€æ˜¯mNï¼ˆä¾‹å¦‚m1ï¼Œm2ï¼‰æ ¼å¼ï¼Œè¡¨æ˜Žäº†è¿™ä¸ªç‰ˆæœ¬åŠ å…¥äº†ä¸€äº›ç»è¿‡å½»åº•æµ‹è¯•çš„æ–°ç‰¹æ€§ï¼Œå¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªè¯•ç”Ÿäº§çš„æ¨¡å…·ï¼›å¦‚æžœè¿™ä¸ªåŽç¼€æ˜¯rcï¼Œè¡¨æ˜Žäº†è¿™æ˜¯ä¸€ä¸ªå€™é€‰ç‰ˆæœ¬ï¼Œå·²ç»ä¿®æ”¹äº†å·²çŸ¥çš„é‡è¦bugï¼Œä½†æ˜¯æ²¡æœ‰ç»è¿‡è¶³å¤Ÿé•¿æ—¶é—´çš„ä½¿ç”¨æ¥ç¡®è®¤æ‰€æœ‰çš„bugå·²ç»è¢«ä¿®å¤ã€‚ ä¸€æ—¦é€‰æ‹©äº†ç‰ˆæœ¬å·ï¼Œå°±è¦é€‰æ‹©ä½¿ç”¨å“ªä¸ªå‘è¡Œç‰ˆï¼Œä½ å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶å‘è¡Œç‰ˆå¦‚RPMåŒ…æˆ–ZipåŽ‹ç¼©åŒ…ç­‰ï¼Œä½†æ˜¯å¦‚æžœä½ è¦å®žçŽ°å¦‚ä¸‹çš„åŠŸèƒ½ï¼Œå°±è¦é€‰æ‹©æºç å®‰è£…ï¼ˆæœ¬æ–‡æ­£æ˜¯é€‰æ‹©æºç å®‰è£…çš„æ–¹å¼ï¼‰ï¼š æŠŠmysqå®‰è£…åˆ°æŒ‡å®šä½ç½® ä½¿ç”¨mysqlçš„ä¸€äº›ç‰¹æ€§ï¼ˆæ ‡å‡†çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ä¸­å¹¶æ²¡æœ‰è¿™äº›ç‰¹æ€§ï¼‰å¦‚ï¼šTCPå°åŒ…æ”¯æŒï¼Œè°ƒè¯•mysql äºŒè¿›åˆ¶ç‰ˆæœ¬ä¸­é»˜è®¤æ”¯æŒæ‰€æœ‰çš„å­—ç¬¦é›†ï¼Œä½†ä½ å¯ä»¥åœ¨ç¼–è¯‘å®‰è£…æºç æ—¶æŒ‡å®šå­—ç¬¦é›†ï¼Œä»Žè€Œä½¿å¾—å®‰è£…çš„mysqlæ›´å° å¸è½½åŽŸæœ‰MySQLæˆ–è€…MariadbCentOs7ç‰ˆæœ¬é»˜è®¤æƒ…å†µä¸‹å®‰è£…äº†mariadb-libsï¼Œå¿…é¡»å…ˆå¸è½½æ‰å¯ä»¥ç»§ç»­å®‰è£…MySql æŸ¥æ‰¾ä»¥å‰æ˜¯å¦å®‰è£…mariadb-libså¦‚ï¼šmariadb-libs-5.5.35-3.el7.x86_64 1$ rpm -qa | grep -i mariadb-libs å¸è½½å·²ç»å®‰è£…çš„mariadb-libs1$ yum remove mariadb-libs-5.5.35-3.el7.x86_64 æŸ¥æ‰¾ä»¥å‰æ˜¯å¦å®‰è£…MySQL1$ rpm -qa | grep -i mysql å¦‚æžœæ˜¾ç¤ºæœ‰æ•°æ® è¯´æ˜Žå·²ç»å®‰è£…äº† MySQL ç¨‹åº åœæ­¢mysqlæœåŠ¡ 1$ service mysql stop åˆ é™¤ä¹‹å‰å®‰è£…çš„mysql12$ rpm -ve æ–‡ä»¶åç§° ä¾‹å¦‚ï¼šMySQL-server-5.6.24-1.linux_glibc2.5.x86_64$ rpm -ve æ–‡ä»¶åç§° ä¾‹å¦‚ï¼šMySQL-client-5.6.24-1.linux_glibc2.5.x86_64 æŸ¥æ‰¾ä¹‹å‰è€ç‰ˆæœ¬mysqlçš„ç›®å½•ã€å¹¶ä¸”åˆ é™¤è€ç‰ˆæœ¬mysqlçš„æ–‡ä»¶å’Œåº“1$ find / -name mysql å¦‚ï¼š /var/lib/mysql /usr/lib64/mysql /usr/local/mysql /usr/local/mysql/data/mysql åˆ é™¤å¯¹åº”çš„ç›®å½• 123$ rm -rf /var/lib/mysql $ rm -rf /usr/lib64/mysql $ rm -rf /usr/local/mysql åˆ é™¤é…ç½®æ–‡æ¡£ 1$ rm -rf /etc/my.cnf ä¸‹è½½MySQLä¸‹è½½å®ŒåŽéœ€è¦æ£€æŸ¥æ–‡ä»¶çš„MD5ï¼Œä»¥ç¡®è®¤æ˜¯å¦ä»Žå®˜ç½‘ä¸‹è½½çš„åŽŸç‰ˆæœ¬ï¼ˆä»¥é˜²è¢«äººç¯¡æ”¹è¿‡è¯¥è½¯ä»¶ï¼‰ æˆ‘é€‰æ‹©å¦‚ä¸‹ï¼šå®˜ç½‘åœ°å€ ç¼–è¯‘å’Œå®‰è£…MySQLå®‰è£…çŽ¯å¢ƒ12345$ yum -y install make bison-devel ncures-devel libaio$ yum -y install libaio libaio-devel$ yum -y install perl-Data-Dumper$ yum -y install net-tools$ yum -i install bison gcc-c++ cmake ncurses è§£åŽ‹ 1$ tar -zxvf mysql-5.6.32.tar.gz ç¼–è¯‘å®‰è£…123$ cmake \-DCMAKE_INSTALL_PREFIX=/usr/local/mysql56 -DMYSQL_DATADIR=/usr/local/mysql/data -DSYSCONFDIR=/etc/my.cnf -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock -DMYSQL_TCP_PORT=3306 -DENABLED_LOCAL_INFILE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci$ make &amp;&amp; make install 123456789101112131415161718192021222324252627# -DCMAKE_INSTALL_PREFIX=/usr/local/mysql56 \ #å®‰è£…è·¯å¾„ # -DMYSQL_DATADIR=/usr/local/mysql/data \ #æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½® # -DSYSCONFDIR=/etc \ #my.cnfè·¯å¾„ # -DWITH_MYISAM_STORAGE_ENGINE=1 \ #æ”¯æŒMyIASMå¼•æ“Ž # -DWITH_INNOBASE_STORAGE_ENGINE=1 \ #æ”¯æŒInnoDBå¼•æ“Ž # -DWITH_MEMORY_STORAGE_ENGINE=1 \ #æ”¯æŒMemoryå¼•æ“Ž # -DWITH_READLINE=1 \ #å¿«æ·é”®åŠŸèƒ½(æˆ‘æ²¡ç”¨è¿‡) # -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \ #è¿žæŽ¥æ•°æ®åº“socketè·¯å¾„ # -DMYSQL_TCP_PORT=3306 \ #ç«¯å£ # -DENABLED_LOCAL_INFILE=1 \ #å…è®¸ä»Žæœ¬åœ°å¯¼å…¥æ•°æ® # -DWITH_PARTITION_STORAGE_ENGINE=1 \ #å®‰è£…æ”¯æŒæ•°æ®åº“åˆ†åŒº # -DEXTRA_CHARSETS=all \ #å®‰è£…æ‰€æœ‰çš„å­—ç¬¦é›† # -DDEFAULT_CHARSET=utf8 \ #é»˜è®¤å­—ç¬¦ # -DDEFAULT_COLLATION=utf8_general_ci é…ç½®MySQL æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰mysqlç”¨æˆ·ï¼Œå¦‚æžœæ²¡æœ‰åˆ™åˆ›å»º 12$ cat /etc/passwd | grep mysql$ cat /etc/group | grep mysql åˆ›å»ºmysqlç”¨æˆ·ï¼ˆä½†æ˜¯ä¸èƒ½ä½¿ç”¨mysqlè´¦å·ç™»é™†ç³»ç»Ÿ 12$ groupadd mysql$ useradd -g -s mysql mysql ä¿®æ”¹æƒé™ 123456789$ chown -R mysql:mysql /usr/local/mysql$ cd /usr/local/mysql$ chown -R mysql:mysql .$ scripts/mysql_install_db --user=mysql# å°†æƒé™è®¾ç½®ç»™rootç”¨æˆ·ï¼Œå¹¶è®¾ç½®ç»™mysqlç»„ï¼Œ å–æ¶ˆå…¶ä»–ç”¨æˆ·çš„è¯»å†™æ‰§è¡Œæƒé™ï¼Œ# ä»…ç•™ç»™mysql &quot;rx&quot;è¯»æ‰§è¡Œæƒé™ï¼Œå…¶ä»–ç”¨æˆ·æ— ä»»ä½•æƒé™$ chown -R root:mysql .$ chown -R mysql:mysql ./data$ chmod -R ug+rwx . å°†mysqlçš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°/etc 123$ cp support-files/my-default.cnf /etc/my.cnf# æ³¨æ„ï¼š5.6 ä¹‹å‰å¦‚ä¸‹$ cp support-files/my-medium.cnf /etc/my.cnf ä¿®æ”¹my.cnfé…ç½® 1$ vim /etc/my.cnf [mysqld] ä¸‹é¢æ·»åŠ ï¼š user=mysql datadir=/data/mysql default-storage-engine=MyISAM å¯åŠ¨mysql 123# å°†mysqlçš„å¯åŠ¨æœåŠ¡æ·»åŠ åˆ°ç³»ç»ŸæœåŠ¡ä¸­$ cp support-files/mysql.server /etc/init.d/mysql$ service mysql start å¢žåŠ MySQLæœåŠ¡ 1$ chkconfig --add mysql ä¿®æ”¹rootç”¨æˆ·å¯†ç  123$ cd /usr/local/mysql56$ ./bin/mysqladmin -u root password$ service mysql restart å¸¸ç”¨åŸºç¡€æ“ä½œ12345678910111213$ mysql -u root -p root-- æŸ¥çœ‹æ•°æ®åº“show databases;-- åˆ›å»ºç”¨æˆ·å¹¶å…è®¸æœ¬åœ°ç”¨æˆ·é€šè¿‡å¯†ç ç™»å½•create user &apos;username&apos;@&apos;localhost&apos; identified by &apos;user-password&apos;;-- åˆ›å»ºæ•°æ®åº“create database schema_name;-- ä¸å¯æŽˆæƒç»™å…¶ä»–ç”¨æˆ·(* è¡¨ç¤ºè¯¥æ•°æ®åº“ä¸‹æ‰€æœ‰çš„è¡¨å)grant all privileges on schema_name.* to &apos;username&apos;@&apos;remote-ip&apos; identified by &apos;remote-user-password&apos; -- å¯æŽˆæƒç»™å…¶ä»–ç”¨æˆ·grant all privileges on schema_name.* to &apos;username&apos;@&apos;remote-ip&apos; identified by &apos;remote-user-password&apos; with grant option;-- åˆ·æ–°flush privileges;]]></content>
      <categories>
        <category>DB</category>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Centos7ä¸‹RabbitMQæœåŠ¡å®‰è£…é…ç½®]]></title>
    <url>%2F2017%2F09%2F22%2FCentos7%E4%B8%8BRabbitMQ%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[å®‰è£… Erlangä¸‹è½½æºç (å®˜ç½‘åœ°å€:)1$ wget http://erlang.org/download/otp_src_19.3.tar.gz å®‰è£…ä¾èµ–1$ yum install gcc glibc-devel make ncurses-devel openssl-devel xmlto è§£åŽ‹ç¬¬ä¸€æ­¥ä¸‹è½½çš„æºç 12$ tar zxvf otp_src_19.3.tar.gz$ cd opt_src_19.3 é…ç½®å®‰è£…è·¯å¾„ç¼–è¯‘ä»£ç 1$ ./configure --prefix=/opt/erlang æ‰§è¡Œç¼–è¯‘ç»“æžœ1$ make &amp;&amp; make install éªŒè¯1$ ./opt/erlang/bin/erl è®¾ç½®çŽ¯å¢ƒå˜é‡vim /etc/profile12#set erlang environmentexport PATH=$PATH:/opt/erlang/bin ç¼–è¯‘çŽ¯å¢ƒå˜é‡1$ source /etc/profile å®‰è£…RabbitMQä¸‹è½½(å®˜ç½‘åœ°å€:)1$ wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.11/rabbitmq-server-generic-unix-3.6.11.tar.xz è§£åŽ‹æ–‡ä»¶å¹¶é‡å‘½å1234$ xz -d rabbitmq-server-generic-unix-3.6.1.tar.xz$ tar -xvf rabbitmq-server-generic-unix-3.6.1.tar -C /opt$ cd /opt$ mv rabbitmq_server-3.6.11 rabbitmq è®¾ç½®çŽ¯å¢ƒå˜é‡vim /etc/profile12#set rabbitmq environmentexport PATH=$PATH:/opt/rabbitmq/sbin ç¼–è¯‘çŽ¯å¢ƒå˜é‡1$ source /etc/profile åˆ›å»ºæ—¥å¿—æ–‡ä»¶RabbitMQä½¿ç”¨Mnesiaæ•°æ®åº“å­˜å‚¨æœåŠ¡å™¨ä¿¡æ¯ï¼Œæ¯”å¦‚é˜Ÿåˆ—å…ƒæ•°æ®ï¼Œè™šæ‹Ÿä¸»æœºç­‰. 12$ mkdir -p /var/log/rabbitmq$ mkdir -p /var/log/rabbitmq/mnesia/rabbit å¯åŠ¨æœåŠ¡12# cd /opt/rabbitmq/sbin$ ./rabbitmq-server -detached é…ç½®ç½‘é¡µæ’ä»¶1$ ./rabbitmq-plugins enable rabbitmq_management è¿œç¨‹è®¿é—®é…ç½® æ·»åŠ ç”¨æˆ·:rabbitmqctl add_user hxb hxb æ·»åŠ æƒé™:rabbitmqctl set_permissions -p &quot;/&quot; hxb &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; ä¿®æ”¹ç”¨æˆ·è§’è‰²:rabbitmqctl set_user_tags hxb administrator RabbitMQçš„ç”¨æˆ·è§’è‰²åˆ†ç±»RabbitMQçš„ç”¨æˆ·è§’è‰²åˆ†ç±»ï¼šnoneã€managementã€policymakerã€monitoringã€administrator è§’è‰²-none ä¸èƒ½è®¿é—® management plugin è§’è‰²-management ç”¨æˆ·å¯ä»¥é€šè¿‡AMQPåšçš„ä»»ä½•äº‹å¤–åŠ ï¼š åˆ—å‡ºè‡ªå·±å¯ä»¥é€šè¿‡AMQPç™»å…¥çš„virtual hosts æŸ¥çœ‹è‡ªå·±çš„virtual hostsä¸­çš„queues, exchanges å’Œ bindings æŸ¥çœ‹å’Œå…³é—­è‡ªå·±çš„channels å’Œ connections æŸ¥çœ‹æœ‰å…³è‡ªå·±çš„virtual hostsçš„â€œå…¨å±€â€çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«å…¶ä»–ç”¨æˆ·åœ¨è¿™äº›virtual hostsä¸­çš„æ´»åŠ¨ã€‚ è§’è‰²-policymaker managementå¯ä»¥åšçš„ä»»ä½•äº‹å¤–åŠ ï¼š æŸ¥çœ‹ã€åˆ›å»ºå’Œåˆ é™¤è‡ªå·±çš„virtual hostsæ‰€å±žçš„policieså’Œparameters è§’è‰²-monitoring managementå¯ä»¥åšçš„ä»»ä½•äº‹å¤–åŠ ï¼š åˆ—å‡ºæ‰€æœ‰virtual hostsï¼ŒåŒ…æ‹¬ä»–ä»¬ä¸èƒ½ç™»å½•çš„virtual hosts æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„connectionså’Œchannels æŸ¥çœ‹èŠ‚ç‚¹çº§åˆ«çš„æ•°æ®å¦‚clusteringå’Œmemoryä½¿ç”¨æƒ…å†µ æŸ¥çœ‹çœŸæ­£çš„å…³äºŽæ‰€æœ‰virtual hostsçš„å…¨å±€çš„ç»Ÿè®¡ä¿¡æ¯ è§’è‰²-administrator policymakerå’Œmonitoringå¯ä»¥åšçš„ä»»ä½•äº‹å¤–åŠ : åˆ›å»ºå’Œåˆ é™¤virtual hosts æŸ¥çœ‹ã€åˆ›å»ºå’Œåˆ é™¤users æŸ¥çœ‹åˆ›å»ºå’Œåˆ é™¤permissions å…³é—­å…¶ä»–ç”¨æˆ·çš„connections RabbitMQå¸¸ç”¨å‘½ä»¤add_user &lt;UserName&gt; &lt;Password&gt; delete_user &lt;UserName&gt; change_password &lt;UserName&gt; &lt;NewPassword&gt; list_users add_vhost &lt;VHostPath&gt; delete_vhost &lt;VHostPath&gt; list_vhostsset_permissions [-p &lt;VHostPath&gt;] &lt;UserName&gt; &lt;Regexp&gt; &lt;Regexp&gt; &lt;Regexp&gt; clear_permissions [-p &lt;VHostPath&gt;] &lt;UserName&gt; list_permissions [-p &lt;VHostPath&gt;] list_user_permissions &lt;UserName&gt; list_queues [-p &lt;VHostPath&gt;] [&lt;QueueInfoItem&gt; ...] list_exchanges [-p &lt;VHostPath&gt;] [&lt;ExchangeInfoItem&gt; ...] list_bindings [-p &lt;VHostPath&gt;] list_connections [&lt;ConnectionInfoItem&gt; ...]]]></content>
      <categories>
        <category>middleware</category>
        <category>RabbitMQ</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æˆ‘è®©è‡ªå·±è‡ªç”±äº†ä¸‰å¹´]]></title>
    <url>%2F2017%2F09%2F18%2F%E6%88%91%E8%AE%A9%E8%87%AA%E5%B7%B1%E8%87%AA%E7%94%B1%E4%BA%86%E4%B8%89%E5%B9%B4%2F</url>
    <content type="text"><![CDATA[æˆ‘è®©è‡ªå·±è‡ªç”±äº†ä¸‰å¹´-è¿Ÿæ¥çš„äººç”Ÿè§„åˆ’ï¼ˆæœªæ¥çš„3å¹´è®¡åˆ’5å¹´è§„åˆ’ï¼‰ æ„Ÿè§‰è¿™ä¸€åˆ»æ‰åˆšå¼€å§‹ï¼ˆæ¯•ä¸šåŽçš„é¢è¯•ä¸­æ€»ä¼šé‡åˆ°ä½ æœªæ¥çš„äº”å¹´è§„åˆ’æˆ–è€…è®¡åˆ’æ˜¯ä»€ä¹ˆï¼Ÿæ”¯æ”¯å¾å¾äº†ä¸‹-ðŸ˜… æŽ¥ç€é—®åˆ°ä½ æœªæ¥ä¸‰å¹´æ˜¯ä»€ä¹ˆæˆ–è€…æŽ¥ä¸‹æ¥ä¸€å¹´æ˜¯ä»€ä¹ˆï¼ŸæŽ¥ç€ðŸ˜…ï¼‰ å°±è¿™æ ·å°´å°¬äº†ä¸‰å¹´ï¼ˆå·¥ä½œä¸Šä¸€ç›´åœ¨è¢«åŠ¨å·¥ä½œï¼Œå­¦ä¹ ä¸Šå‡ ä¹Žæ²¡æœ‰ï¼Œæœ€åŽç»åŽ†äº†ç”±æ‹çˆ±åˆ°å¯‚å¯žä¸Žå­¤ç‹¬ï¼‰ 2018-2020å¹´ æˆ‘çš„äººç”Ÿç¬¬ä¸€ä¸ªä¸‰å¹´è®¡åˆ’2021-2025å¹´ æˆ‘çš„äººç”Ÿç¬¬ä¸€ä¸ªäº”å¹´è§„åˆ’2018-2020å¹´ æˆ‘è¦åœ¨æˆéƒ½åœ¨è‹±å­šæŠŠæˆ‘çš„è‹±è¯­åŸ¹è®­èµ·æ¥ï¼ˆè‡³å°‘è¦å…»æˆä¸€ä¸ªæ¯å¤©å­¦è‹±è¯­çš„å¥½ä¹ æƒ¯ï¼‰ï¼›å·¥ä½œä¸Šæˆ‘å¿…é¡»åœ¨devopsè¿™ä¸€å—ä¸æ–­çš„å¤¯å®žè‡ªå·± åŠ å€æ—¶é—´åŽ»å®Œæˆï¼ˆä¸»æ‰“java æ¶‰åŠpython go jsï¼‰ï¼›ç”Ÿæ´»é‡Œèƒ½å¦æ‰¾åˆ°è‡ªå·±å¿ƒä»ªçš„é€‚åˆç»“å©šçš„å¥½å¥³å­©ðŸ˜Šï¼›åœ¨çˆ¶æ¯çš„å¸®åŠ©ä¸‹å¿…é¡»ä¸€å®šå¾—è‡ªå·±åŽ»åœ¨æˆéƒ½æŒ‰æ­ä¸€å¥—å¿ƒä»ªçš„æˆ¿å­ï¼›è½¦èƒ½ä¸ä¹°å°±ä¸ä¹° ä¹°äº†ä¹Ÿæ˜¯åƒç°ðŸ˜‚ðŸ¤¦â€â™‚ï¸2021-2025å¹´ åœ¨ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„å…¬å¸æŠŠå®ƒå½“æˆè‡ªå·±çš„å…¬å¸å°½æˆ‘æ‰€èƒ½çœ‹çœ‹æˆ‘èƒ½ä¸ºå…¬å¸åˆ›é€ å¤šå¤§çš„æ•ˆç›Šå¹¶ä¸”å¯¹æ¯”ä¸€ä¸‹å…¬å¸ä¸ºæˆ‘çš„èŠ±è´¹ï¼ˆå…¬å¸åœ°å€ä¸å±€é™äºŽå›½å†…ðŸ˜„ðŸ’ªï¼‰ è¿™æ—¶å€™è‡ªå·±35å²äº†å¿…é¡»å¾—æœ‰ä¸€ä¸ªå¹¸ç¦çš„å®¶åº­ï¼ˆåœ¨æ­¤ä¹‹å‰èƒ½å¤Ÿå…¼é¡¾åˆ°å¹¶å®Œæˆå½“ç„¶æ›´å¥½ðŸ˜‚ðŸ’ªï¼‰ï¼›é€‰æ‹©ä¸Žèƒ½å¤Ÿéžå¸¸éžå¸¸éžå¸¸ä¿¡ä»»çš„æœ‹å‹å¤§å®¶ä¸€æ¡å¿ƒçš„åŽ»åˆ›ä¸šï¼ˆäº§å“æ–¹å‘èƒ½å¤Ÿä¸ºç¤¾ä¼šä¸ºäººä»¬å¸¦æ¥ä¾¿åˆ©ä¸Žå¥½å¤„ï¼‰or èƒ½é‡åˆ°ä¸€ä¸ªç†æƒ³çš„å¥½å¹³å°è¾¾åˆ°å’Œè‡ªå·±åˆ›ä¸šä¸€è‡´çš„èƒ½å¤Ÿé«˜é€Ÿé«˜è´¨é‡ç¨³å®šçš„é©¶å‘è¿œæ–¹ è®©è‡ªå·±å¯¹è¿™ä¸ªä¸–ç•Œç”šè‡³è¿™èŒ«èŒ«æ˜Ÿäº‘ä¸­äº†è§£çš„æ›´å¤šæŽ¢ç´¢çš„æ›´å¤š è¿™ä¸€åˆ‡éƒ½å¿…é¡»å¾—èº«ä½“å¥åº·â›½ï¸ å¤§å”é˜¶æ®µèƒ½æŠŠå¦¹ï¼ŒèŠ±ç”²ä¹‹å¹´èƒ½æŠ±å­™å­å­™å¥³ï¼Œæœ‰ç”Ÿä¹‹å¹´èƒ½è§é‡å­™é‡å­™å¥³ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â€”ç¨‹åºå‘˜ä¹Ÿæœ‰çš„å¹¸ç¦]]></content>
      <categories>
        <category>è§„åˆ’ä¸Žè®¡åˆ’</category>
        <category>äººç”Ÿè§„åˆ’</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åœ¨CentOS7ä¸Šéƒ¨ç½²kubernetes1.7 HA é›†ç¾¤(Vagrant)]]></title>
    <url>%2F2017%2F09%2F13%2F%E5%9C%A8CentOS7%E4%B8%8A%E9%83%A8%E7%BD%B2kubernetes1-7-HA-%E9%9B%86%E7%BE%A4-Vagrant%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨virtualbox + vagrantå®‰è£…centos7vagrantå‡†æœ¬å·¥ä½œ1ã€å…·ä½“å®‰è£…å’Œä½¿ç”¨virtualbox &amp;&amp; vagrantè¯·è‡ªè¡ŒGoogle 2ã€æœç´¢centos7 box:https://app.vagrantup.com/boxes/search?provider=virtualbox 3ã€ç”ŸæˆVagrantfile 123mkdir -p ~/Vagrant/k8s-clustercd ~/Vagrant/k8s-clustervagrant init centos/7 å®‰è£…centos71ã€ç¼–è¾‘Vagrantfile 123cd ~/Vagrant/k8s-clustercp Vagrantfile ./Vagrantfile_backupemacs Vagrantfile Vagrantfile å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# coding: utf-8Vagrant.configure(&quot;2&quot;) do |config| (11..13).each do |i| config.vm.define &quot;k8s-master#&#123;i&#125;&quot; do |node| # è®¾ç½®è™šæ‹Ÿæœºçš„Box node.vm.box = &quot;centos/7&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå node.vm.hostname=&quot;master#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„IP node.vm.network &quot;public_network&quot;, ip: &quot;192.168.7.#&#123;i&#125;&quot;, :bridge=&gt;&apos;en0: Wi-Fi (AirPort)&apos; node.vm.boot_timeout = 20 # è®¾ç½®ä¸»æœºä¸Žè™šæ‹Ÿæœºçš„å…±äº«ç›®å½• node.vm.synced_folder &quot;/Users/sunbjx/Vagrant/share&quot;, &quot;/home/vagrant/share&quot; # VirtaulBoxç›¸å…³é…ç½® node.vm.provider &quot;virtualbox&quot; do |v| # è®¾ç½®è™šæ‹Ÿæœºçš„åç§° v.name = &quot;k8s-master#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å° v.memory = 4096 # è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•° v.cpus = 2 end # ä½¿ç”¨shellè„šæœ¬è¿›è¡Œè½¯ä»¶å®‰è£…å’Œé…ç½® node.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL sudo yum -y update sudo yum -y install net-tools sudo yum -y install vim SHELL end end (14..15).each do |i| config.vm.define &quot;k8s-node#&#123;i&#125;&quot; do |node| # è®¾ç½®è™šæ‹Ÿæœºçš„Box node.vm.box = &quot;centos/7&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå node.vm.hostname=&quot;node#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„IP node.vm.network &quot;public_network&quot;, ip: &quot;192.168.7.#&#123;i&#125;&quot;, :bridge=&gt;&apos;en0: Wi-Fi (AirPort)&apos; node.vm.boot_timeout = 20 # è®¾ç½®ä¸»æœºä¸Žè™šæ‹Ÿæœºçš„å…±äº«ç›®å½• node.vm.synced_folder &quot;/Users/sunbjx/Vagrant/share&quot;, &quot;/home/vagrant/share&quot; # VirtaulBoxç›¸å…³é…ç½® node.vm.provider &quot;virtualbox&quot; do |v| # è®¾ç½®è™šæ‹Ÿæœºçš„åç§° v.name = &quot;k8s-node#&#123;i&#125;&quot; # è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å° v.memory = 8192 # è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•° v.cpus = 2 end # ä½¿ç”¨shellè„šæœ¬è¿›è¡Œè½¯ä»¶å®‰è£…å’Œé…ç½® node.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL sudo yum -y update sudo yum -y install net-tools sudo yum -y install vim SHELL end endend 2ã€å¯åŠ¨å®‰è£…centos7 1vagrant up çŽ¯å¢ƒè¯´æ˜ŽçŽ¯å¢ƒæ€»å…± 5 å°è™šæ‹Ÿæœºï¼Œ3 ä¸ª masterï¼Œ3 ä¸ª etcd èŠ‚ç‚¹ï¼Œ2 ä¸ª node ç½‘ç»œæ–¹æ¡ˆè¿™é‡Œé‡‡ç”¨flannelï¼Œé›†ç¾¤å¼€å¯ RBAC IP èŠ‚ç‚¹ 192.168.7.11 masterã€etcd 192.168.7.12 masterã€etcd 192.168.7.13 masterã€etcd 192.168.7.14 node 192.168.7.15 node åˆ›å»º TLSè¯ä¹¦å’Œç§˜é’¥è¯ä¹¦è¯´æ˜Ž è¯ä¹¦åç§° é…ç½®æ–‡ä»¶ ç”¨é€” etcd-root-ca.pem etcd-root-ca-csr.json etcd æ ¹ CA è¯ä¹¦ etcd.pem etcd-gencert.jsonã€etcd-csr.json etcd é›†ç¾¤è¯ä¹¦ k8s-root-ca.pem k8s-root-ca-csr.json k8s æ ¹ CA è¯ä¹¦ kube-proxy.pem k8s-gencert.jsonã€kube-proxy-csr.json kube-proxy ä½¿ç”¨çš„è¯ä¹¦ admin.pem k8s-gencert.jsonã€admin-csr.json kubectl ä½¿ç”¨çš„è¯ä¹¦ kubernetes.pem k8s-gencert.jsonã€kubernetes-csr.json kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ å®‰è£…CFSSL (192.168.7.11)12345678910111213mkdir -p ~/downloadcd ~/download# ä¸‹è½½ go1.8.3wget https://golang.org/dl/go1.8.3.linux-amd64.tar.gz# è§£åŽ‹åŽ‹ç¼©åŒ…tar -C /usr/local -xzf go1.8.3.linux-amd64.tar.gz# æ·»åŠ çŽ¯å¢ƒå˜é‡vim /etc/profileexport GOROOT=/usr/local/goexport PATH=$PATH:$GOROOT/binsource /etc/profile# ä½¿ç”¨ go å‘½ä»¤å®‰è£… cfsslgo get -u github.com/cloudflare/cfssl/cmd/... ç”Ÿæˆetcdè¯ä¹¦ (192.168.7.11) etcd è¯ä¹¦é…ç½®æ–‡ä»¶ 12mkdir -p ~/document/sslcd ~/document/ssl vim etcd-root-ca-csr.json 12345678910111213141516&#123; &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 4096 &#125;, &quot;names&quot;: [ &#123; &quot;O&quot;: &quot;etcd&quot;, &quot;OU&quot;: &quot;etcd Security&quot;, &quot;L&quot;: &quot;Beijing&quot;, &quot;ST&quot;: &quot;Beijing&quot;, &quot;C&quot;: &quot;CN&quot; &#125; ], &quot;CN&quot;: &quot;etcd-root-ca&quot;&#125; vim etcd-gencert.json 12345678910111213&#123; &quot;signing&quot;: &#123; &quot;default&quot;: &#123; &quot;usages&quot;: [ &quot;signing&quot;, &quot;key encipherment&quot;, &quot;server auth&quot;, &quot;client auth&quot; ], &quot;expiry&quot;: &quot;87600h&quot; &#125; &#125;&#125; vim etcd-csr.json 12345678910111213141516171819202122232425&#123; &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 4096 &#125;, &quot;names&quot;: [ &#123; &quot;O&quot;: &quot;etcd&quot;, &quot;OU&quot;: &quot;etcd Security&quot;, &quot;L&quot;: &quot;Beijing&quot;, &quot;ST&quot;: &quot;Beijing&quot;, &quot;C&quot;: &quot;CN&quot; &#125; ], &quot;CN&quot;: &quot;etcd&quot;, &quot;hosts&quot;: [ &quot;127.0.0.1&quot;, &quot;localhost&quot;, &quot;192.168.1.11&quot;, &quot;192.168.1.12&quot;, &quot;192.168.1.13&quot;, &quot;192.168.1.14&quot;, &quot;192.168.1.15&quot; ]&#125; â€œCNâ€ï¼šCommon Nameï¼Œkube-apiserver ä»Žè¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·å (User Name)ï¼›æµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘ç«™æ˜¯å¦åˆæ³•ï¼›â€œOâ€ï¼šOrganizationï¼Œkube-apiserver ä»Žè¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚ç”¨æˆ·æ‰€å±žçš„ç»„ (Group) ç”Ÿæˆ etcd è¯ä¹¦ 12cfssl gencert --initca=true etcd-root-ca-csr.json | cfssljson --bare etcd-root-cacfssl gencert --ca etcd-root-ca.pem --ca-key etcd-root-ca-key.pem --config etcd-gencert.json etcd-csr.json | cfssljson --bare etcd ç”Ÿæˆ kubernetes è¯ä¹¦ (192.168.7.11) kubernetes è¯ä¹¦é…ç½®æ–‡ä»¶ vim k8s-root-ca-csr.json 12345678910111213141516&#123; &quot;CN&quot;: &quot;kubernetes&quot;, &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 4096 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; vim k8s-gencert.json 123456789101112131415161718&#123; &quot;signing&quot;: &#123; &quot;default&quot;: &#123; &quot;expiry&quot;: &quot;87600h&quot; &#125;, &quot;profiles&quot;: &#123; &quot;kubernetes&quot;: &#123; &quot;usages&quot;: [ &quot;signing&quot;, &quot;key encipherment&quot;, &quot;server auth&quot;, &quot;client auth&quot; ], &quot;expiry&quot;: &quot;87600h&quot; &#125; &#125; &#125;&#125; vim kubernetes-csr.json 12345678910111213141516171819202122232425262728293031&#123; &quot;CN&quot;: &quot;kubernetes&quot;, &quot;hosts&quot;: [ &quot;127.0.0.1&quot;, &quot;10.254.0.1&quot;, &quot;192.168.7.11&quot;, &quot;192.168.7.12&quot;, &quot;192.168.7.13&quot;, &quot;192.168.7.14&quot;, &quot;192.168.7.15&quot;, &quot;localhost&quot;, &quot;kubernetes&quot;, &quot;kubernetes.default&quot;, &quot;kubernetes.default.svc&quot;, &quot;kubernetes.default.svc.cluster&quot;, &quot;kubernetes.default.svc.cluster.local&quot; ], &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; vim kube-proxy-csr.json 1234567891011121314151617&#123; &quot;CN&quot;: &quot;system:kube-proxy&quot;, &quot;hosts&quot;: [], &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; vim admin-csr.json 1234567891011121314151617&#123; &quot;CN&quot;: &quot;admin&quot;, &quot;hosts&quot;: [], &quot;key&quot;: &#123; &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 &#125;, &quot;names&quot;: [ &#123; &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;system:masters&quot;, &quot;OU&quot;: &quot;System&quot; &#125; ]&#125; ç”Ÿæˆ kubernetes è¯ä¹¦ 12345cfssl gencert --initca=true k8s-root-ca-csr.json | cfssljson --bare k8s-root-cafor targetName in kubernetes admin kube-proxy; do cfssl gencert --ca k8s-root-ca.pem --ca-key k8s-root-ca-key.pem --config k8s-gencert.json --profile kubernetes $targetName-csr.json | cfssljson --bare $targetNamedone åˆ†å‘æ‰€éœ€è¯ä¹¦åˆ°å„ä¸ªèŠ‚ç‚¹ç›®å½• /etc/kubernetes/ssl ä¸‹é¢ 123456789for IP in `seq 1 5`;do ssh root@192.168.1.1$IP mkdir -p /etc/etcd/ssl sudo scp ~/document/ssl/etcd*.pem root@192.168.1.1$IP:/etc/etcd/ssl ssh root@192.168.1.1$IP chown -R etcd:etcd /etc/etcd/ssl ssh root@192.168.1.1$IP chmod -R 755 /etc/etcd ssh root@192.168.7.1$IP mkdir -p /etc/kubernetes/ssl sudo scp ~/document/ssl/*.pem root@192.168.7.1$IP:/etc/kubernetes/ssl ssh root@192.168.7.1$IP chown -R kube:kube /etc/kubernetes/ssldone ç”Ÿæˆ token åŠ kubeconfig (192.168.7.11)kubeletã€kube-proxy ç­‰ Node æœºå™¨ä¸Šçš„è¿›ç¨‹ä¸Ž Master æœºå™¨çš„ kube-apiserver è¿›ç¨‹é€šä¿¡æ—¶éœ€è¦è®¤è¯å’ŒæŽˆæƒï¼›kubernetes 1.4 å¼€å§‹æ”¯æŒç”± kube-apiserver ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆ TLS è¯ä¹¦çš„ TLS Bootstrapping åŠŸèƒ½ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆè¯ä¹¦äº†ï¼›è¯¥åŠŸèƒ½å½“å‰ä»…æ”¯æŒä¸º kubelet ç”Ÿæˆè¯ä¹¦ ç”Ÿæˆ token 12345cd /etc/kubernetesexport BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &apos; &apos;)cat &gt; token.csv &lt;&lt;EOF$&#123;BOOTSTRAP_TOKEN&#125;,kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;EOF BOOTSTRAP_TOKEN å°†è¢«å†™å…¥åˆ° kube-apiserver ä½¿ç”¨çš„ token.csv æ–‡ä»¶å’Œ kubelet ä½¿ç”¨çš„ bootstrap.kubeconfig æ–‡ä»¶ï¼Œå¦‚æžœåŽç»­é‡æ–°ç”Ÿæˆäº† BOOTSTRAP_TOKENï¼Œåˆ™éœ€è¦ï¼šæ›´æ–° token.csv æ–‡ä»¶ï¼Œåˆ†å‘åˆ°æ‰€æœ‰æœºå™¨ (master å’Œ nodeï¼‰çš„ /etc/kubernetes/ ç›®å½•ä¸‹ï¼Œåˆ†å‘åˆ°nodeèŠ‚ç‚¹ä¸Šéžå¿…éœ€ï¼›é‡æ–°ç”Ÿæˆ bootstrap.kubeconfig æ–‡ä»¶ï¼Œåˆ†å‘åˆ°æ‰€æœ‰ node æœºå™¨çš„ /etc/kubernetes/ ç›®å½•ä¸‹ï¼›é‡å¯ kube-apiserver å’Œ kubelet è¿›ç¨‹ï¼›é‡æ–° approve kubelet çš„ csr è¯·æ±‚ å®‰è£… kubernetes å¹¶å°† kube-apiserver,kube-controller-manager,kube-scheduler,kubectl åˆ†å‘åˆ° master; kubelet,kube-proxy åˆ†å‘åˆ° node; åŒæ—¶åˆ†å‘æ‰€éœ€è¯ä¹¦åˆ°å„ä¸ªèŠ‚ç‚¹ç›®å½• /etc/kubernetes/ssl ä¸‹é¢ 123456789101112131415161718cd ~/downloadwget https://github.com/kubernetes/kubernetes/releases/download/v1.7.4/kubernetes.tar.gztar -zxvf kubernetes.tar.gzcd kubernetes./cluster/get-kube-binaries.shcd kubernetes/servertar -zxvf kubernetes-server-linux-amd64.tar.gzcd kubernetes/server/binfor IP in `seq 1 3`;do sudo scp ./&#123;kube-apiserver,kube-controller-manager,kube-scheduler,kubectl&#125; root@192.168.7.1$IP:/usr/local/bin/ ssh root@192.168.7.1$IP chmod a+x /usr/local/bin/kube*donefor IP in `seq 4 5`;do sudo scp ./&#123;kubelet,kube-proxy&#125; root@192.168.7.1$IP:/usr/local/bin ssh root@192.168.7.1$IP chmod a+x /usr/local/bin/kube*done åˆ›å»º kubelet bootstrapping kubeconfig æ–‡ä»¶ 12345678910111213141516171819cd /etc/kubernetesexport KUBE_APISERVER=&quot;https://192.168.7.11:6443&quot;# è®¾ç½®é›†ç¾¤å‚æ•°kubectl config set-cluster kubernetes \ --certificate-authority=/etc/kubernetes/ssl/k8s-root-ca.pem \ --embed-certs=true \ --server=$&#123;KUBE_APISERVER&#125; \ --kubeconfig=bootstrap.kubeconfig# è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°kubectl config set-credentials kubelet-bootstrap \ --token=$&#123;BOOTSTRAP_TOKEN&#125; \ --kubeconfig=bootstrap.kubeconfig# è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°kubectl config set-context default \ --cluster=kubernetes \ --user=kubelet-bootstrap \ --kubeconfig=bootstrap.kubeconfig# è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡kubectl config use-context default --kubeconfig=bootstrap.kubeconfig â€“embed-certs ä¸º true æ—¶è¡¨ç¤ºå°† certificate-authority è¯ä¹¦å†™å…¥åˆ°ç”Ÿæˆçš„ bootstrap.kubeconfig æ–‡ä»¶ä¸­ï¼›è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°æ—¶æ²¡æœ‰æŒ‡å®šç§˜é’¥å’Œè¯ä¹¦ï¼ŒåŽç»­ç”± kube-apiserver è‡ªåŠ¨ç”Ÿæˆ åˆ›å»º kube-proxy kubeconfig æ–‡ä»¶ 12345678910111213141516171819# è®¾ç½®é›†ç¾¤å‚æ•°kubectl config set-cluster kubernetes \ --certificate-authority=/etc/kubernetes/ssl/k8s-root-ca.pem \ --embed-certs=true \ --server=$&#123;KUBE_APISERVER&#125; \ --kubeconfig=kube-proxy.kubeconfig# è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°kubectl config set-credentials kube-proxy \ --client-certificate=/etc/kubernetes/ssl/kube-proxy.pem \ --client-key=/etc/kubernetes/ssl/kube-proxy-key.pem \ --embed-certs=true \ --kubeconfig=kube-proxy.kubeconfig# è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°kubectl config set-context default \ --cluster=kubernetes \ --user=kube-proxy \ --kubeconfig=kube-proxy.kubeconfig# è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig è®¾ç½®é›†ç¾¤å‚æ•°å’Œå®¢æˆ·ç«¯è®¤è¯å‚æ•°æ—¶ â€“embed-certs éƒ½ä¸º trueï¼Œè¿™ä¼šå°† certificate-authorityã€client-certificate å’Œ client-key æŒ‡å‘çš„è¯ä¹¦æ–‡ä»¶å†…å®¹å†™å…¥åˆ°ç”Ÿæˆçš„ kube-proxy.kubeconfig æ–‡ä»¶ä¸­ï¼›kube-proxy.pem è¯ä¹¦ä¸­ CN ä¸º system:kube-proxyï¼Œkube-apiserver é¢„å®šä¹‰çš„ RoleBinding cluster-admin å°†User system:kube-proxy ä¸Ž Role system:node-proxier ç»‘å®šï¼Œè¯¥ Role æŽˆäºˆäº†è°ƒç”¨ kube-apiserver Proxy ç›¸å…³ API çš„æƒé™ åˆ†å‘ tokenã€kubeconfig æ–‡ä»¶ 1234for IP in `seq 2 5`;do scp *.kubeconfig root@192.168.7.1$IP:/etc/kubernetes scp token.csv root@192.168.7.1$IP:/etc/kubernetesdone éƒ¨ç½² HA etcdå®‰è£… etcd123sudo yum -y install etcdecho &apos;export ETCDCTL_API=3&apos; &gt;&gt; /etc/profilesource /etc/profile ä¿®æ”¹é…ç½® vim /etc/etcd/etc.conf123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# [member]ETCD_NAME=etcd1ETCD_DATA_DIR=&quot;/var/lib/etcd/etcd1.etcd&quot;ETCD_WAL_DIR=&quot;/var/lib/etcd/wal&quot;ETCD_SNAPSHOT_COUNT=&quot;100&quot;ETCD_HEARTBEAT_INTERVAL=&quot;100&quot;ETCD_ELECTION_TIMEOUT=&quot;1000&quot;ETCD_LISTEN_PEER_URLS=&quot;https://192.168.7.11:2380&quot;ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.7.11:2379,http://127.0.0.1:2379&quot;ETCD_MAX_SNAPSHOTS=&quot;5&quot;ETCD_MAX_WALS=&quot;5&quot;#ETCD_CORS=&quot;&quot;##[cluster]ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.7.11:2380&quot;# if you use different ETCD_NAME (e.g. test), set ETCD_INITIAL_CLUSTER value for this name, i.e. &quot;test=http://...&quot;ETCD_INITIAL_CLUSTER=&quot;etcd1=https://192.168.7.11:2380,etcd2=https://192.168.7.12:2380,etcd3=https://192.168.7.13:2380&quot;ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.7.11:2379&quot;#ETCD_DISCOVERY=&quot;&quot;#ETCD_DISCOVERY_SRV=&quot;&quot;#ETCD_DISCOVERY_FALLBACK=&quot;proxy&quot;#ETCD_DISCOVERY_PROXY=&quot;&quot;#ETCD_STRICT_RECONFIG_CHECK=&quot;false&quot;#ETCD_AUTO_COMPACTION_RETENTION=&quot;0&quot;##[proxy]#ETCD_PROXY=&quot;off&quot;#ETCD_PROXY_FAILURE_WAIT=&quot;5000&quot;#ETCD_PROXY_REFRESH_INTERVAL=&quot;30000&quot;#ETCD_PROXY_DIAL_TIMEOUT=&quot;1000&quot;#ETCD_PROXY_WRITE_TIMEOUT=&quot;5000&quot;#ETCD_PROXY_READ_TIMEOUT=&quot;0&quot;##[security]ETCD_CERT_FILE=&quot;/etc/etcd/ssl/etcd.pem&quot;ETCD_KEY_FILE=&quot;/etc/etcd/ssl/etcd-key.pem&quot;ETCD_CLIENT_CERT_AUTH=&quot;true&quot;ETCD_TRUSTED_CA_FILE=&quot;/etc/etcd/ssl/etcd-root-ca.pem&quot;ETCD_AUTO_TLS=&quot;true&quot;ETCD_PEER_CERT_FILE=&quot;/etc/etcd/ssl/etcd.pem&quot;ETCD_PEER_KEY_FILE=&quot;/etc/etcd/ssl/etcd-key.pem&quot;ETCD_PEER_CLIENT_CERT_AUTH=&quot;true&quot;ETCD_PEER_TRUSTED_CA_FILE=&quot;/etc/etcd/ssl/etcd-root-ca.pem&quot;ETCD_PEER_AUTO_TLS=&quot;true&quot;##[logging]#ETCD_DEBUG=&quot;false&quot;# examples for -log-package-levels etcdserver=WARNING,security=DEBUG#ETCD_LOG_PACKAGE_LEVELS=&quot;&quot; å¯åŠ¨åŠéªŒè¯ é…ç½®ä¿®æ”¹åŽåœ¨æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œå¯åŠ¨å³å¯ï¼Œæ³¨æ„ï¼ŒEtcd å„ä¸ªèŠ‚ç‚¹é—´å¿…é¡»ä¿è¯æ—¶é’ŸåŒæ­¥ï¼Œå¦åˆ™ä¼šé€ æˆå¯åŠ¨å¤±è´¥ç­‰é”™è¯¯ 1234567yum -y install ntpsystemctl start ntpdsystemctl enable ntpdhwclock --systohcsystemctl daemon-reloadsystemctl start etcdsystemctl enable etcd éªŒè¯ etcd é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ 12export ETCDCTL_API=3etcdctl --cacert=/etc/etcd/ssl/etcd-root-ca.pem --cert=/etc/etcd/ssl/etcd.pem --key=/etc/etcd/ssl/etcd-key.pem --endpoints=https://192.168.7.11:2379,https://192.168.7.12:2379,https://192.168.7.13:2379 endpoint health éƒ¨ç½² HA masterç”±äºŽ api server ä¼šå†™å…¥ä¸€äº›æ—¥å¿—ï¼Œæ‰€ä»¥å…ˆåˆ›å»ºå¥½ç›¸å…³ç›®å½•ï¼Œå¹¶åšå¥½æŽˆæƒï¼Œé˜²æ­¢å› ä¸ºæƒé™é”™è¯¯å¯¼è‡´ api server æ— æ³•å¯åŠ¨ 12345for IP in `seq 1 3`;do ssh root@192.168.1.1$IP mkdir /var/log/kube-audit ssh root@192.168.1.1$IP chown -R kube:kube /var/log/kube-audit ssh root@192.168.1.1$IP chmod -R 755 /var/log/kube-auditdone åˆ›å»º kube-apiserverçš„serviceé…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/kube-apiserver.service 1234567891011121314151617181920212223242526[Unit]Description=Kubernetes API ServiceDocumentation=https://github.com/GoogleCloudPlatform/kubernetesAfter=network.targetAfter=etcd.service[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/apiserverExecStart=/usr/local/bin/kube-apiserver \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_ETCD_SERVERS \ $KUBE_API_ADDRESS \ $KUBE_API_PORT \ $KUBELET_PORT \ $KUBE_ALLOW_PRIV \ $KUBE_SERVICE_ADDRESSES \ $KUBE_ADMISSION_CONTROL \ $KUBE_API_ARGSRestart=on-failureType=notifyLimitNOFILE=65536[Install]WantedBy=multi-user.target åˆ›å»º kube-controller-managerçš„serivceé…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/kube-controller-manager.service 12345678910111213141516Description=Kubernetes Controller ManagerDocumentation=https://github.com/GoogleCloudPlatform/kubernetes[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/controller-managerExecStart=/usr/local/bin/kube-controller-manager \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_MASTER \ $KUBE_CONTROLLER_MANAGER_ARGSRestart=on-failureLimitNOFILE=65536[Install]WantedBy=multi-user.target åˆ›å»º kube-schedulerçš„serivceé…ç½®æ–‡ä»¶vim /usr/lib/systemd/system/kube-scheduler.service 1234567891011121314151617[Unit]Description=Kubernetes Scheduler PluginDocumentation=https://github.com/GoogleCloudPlatform/kubernetes[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/schedulerExecStart=/usr/local/bin/kube-scheduler \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_MASTER \ $KUBE_SCHEDULER_ARGSRestart=on-failureLimitNOFILE=65536[Install]WantedBy=multi-user.target ä¿®æ”¹ master é…ç½®master éœ€è¦ç¼–è¾‘ configã€apiserverã€controller-managerã€schedulerè¿™å››ä¸ªæ–‡ä»¶ï¼Œå…·ä½“ä¿®æ”¹å¦‚ä¸‹ config é€šç”¨é…ç½®vim /etc/kubernetes/config 12345678910111213141516171819202122#### kubernetes system config## The following values are used to configure various aspects of all# kubernetes services, including## kube-apiserver.service# kube-controller-manager.service# kube-scheduler.service# kubelet.service# kube-proxy.service# logging to stderr means we get it in the systemd journalKUBE_LOGTOSTDERR=&quot;--logtostderr=true&quot;# journal message level, 0 is debugKUBE_LOG_LEVEL=&quot;--v=2&quot;# Should this cluster be allowed to run privileged docker containersKUBE_ALLOW_PRIV=&quot;--allow-privileged=true&quot;# How the controller-manager, scheduler, and proxy find the apiserverKUBE_MASTER=&quot;--master=http://127.0.0.1:8080&quot; apiserver é…ç½®(å…¶ä»–èŠ‚ç‚¹åªæœ‰ IP ä¸åŒ) vim /etc/kubernetes/apiserver 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#### kubernetes system config## The following values are used to configure the kube-apiserver## The address on the local server to listen to.KUBE_API_ADDRESS=&quot;--advertise-address=192.168.7.11 --insecure-bind-address=127.0.0.1 --bind-address=192.168.7.11&quot;# The port on the local server to listen on.KUBE_API_PORT=&quot;--insecure-port=8080 --secure-port=6443&quot;# Port minions listen on# KUBELET_PORT=&quot;--kubelet-port=10250&quot;# Comma separated list of nodes in the etcd clusterKUBE_ETCD_SERVERS=&quot;--etcd-servers=https://192.168.7.11:2379,https://192.168.7.12:2379,https://192.168.7.13:2379&quot;# Address range to use for servicesKUBE_SERVICE_ADDRESSES=&quot;--service-cluster-ip-range=10.254.0.0/16&quot;# default admission control policiesKUBE_ADMISSION_CONTROL=&quot;--admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota&quot;# Add your own!KUBE_API_ARGS=&quot;--authorization-mode=RBAC \ --runtime-config=rbac.authorization.k8s.io/v1beta1 \ --anonymous-auth=false \ --kubelet-https=true \ --experimental-bootstrap-token-auth \ --token-auth-file=/etc/kubernetes/token.csv \ --service-node-port-range=30000-50000 \ --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem \ --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem \ --client-ca-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --service-account-key-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --etcd-quorum-read=true \ --storage-backend=etcd3 \ --etcd-cafile=/etc/etcd/ssl/etcd-root-ca.pem \ --etcd-certfile=/etc/etcd/ssl/etcd.pem \ --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \ --enable-swagger-ui=true \ --apiserver-count=3 \ --audit-log-maxage=30 \ --audit-log-maxbackup=3 \ --audit-log-maxsize=100 \ --audit-log-path=/var/log/kube-audit/audit.log \ --event-ttl=1h&quot; controller-manager é…ç½® vim /etc/kubernetes/controller-manager 1234567891011121314151617#### The following values are used to configure the kubernetes controller-manager# defaults from config and apiserver should be adequate# Add your own!KUBE_CONTROLLER_MANAGER_ARGS=&quot;--address=127.0.0.1 \ --service-cluster-ip-range=10.254.0.0/16 \ --cluster-name=kubernetes \ --cluster-signing-cert-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --cluster-signing-key-file=/etc/kubernetes/ssl/k8s-root-ca-key.pem \ --service-account-private-key-file=/etc/kubernetes/ssl/k8s-root-ca-key.pem \ --root-ca-file=/etc/kubernetes/ssl/k8s-root-ca.pem \ --leader-elect=true \ --node-monitor-grace-period=40s \ --node-monitor-period=5s \ --pod-eviction-timeout=5m0s&quot; scheduler é…ç½® vim /etc/kubernetes/scheduler 1234567#### kubernetes scheduler config# default config should be adequate# Add your own!KUBE_SCHEDULER_ARGS=&quot;--leader-elect=true --address=127.0.0.1&quot; å…¶ä»– master èŠ‚ç‚¹é…ç½®ç›¸åŒï¼Œåªéœ€è¦ä¿®æ”¹ä»¥ä¸‹ IP åœ°å€å³å¯ å¯åŠ¨å„ master èŠ‚ç‚¹ç›¸å…³æœåŠ¡1234567systemctl daemon-reloadsystemctl start kube-apiserversystemctl start kube-controller-managersystemctl start kube-schedulersystemctl enable kube-apiserversystemctl enable kube-controller-managersystemctl enable kube-scheduler éªŒè¯ master èŠ‚ç‚¹åŠŸèƒ½ éƒ¨ç½² nodeåˆ›å»º ClusterRoleBindingkubelet å¯åŠ¨æ—¶å‘ kube-apiserver å‘é€ TLS bootstrapping è¯·æ±‚ï¼Œéœ€è¦å…ˆå°† bootstrap token æ–‡ä»¶ä¸­çš„ kubelet-bootstrap ç”¨æˆ·èµ‹äºˆ system:node-bootstrapper cluster è§’è‰²(role)ï¼Œ ç„¶åŽ kubelet æ‰èƒ½æœ‰æƒé™åˆ›å»ºè®¤è¯è¯·æ±‚(certificate signing requests)ï¼š 1234# åœ¨ä»»æ„ master æ‰§è¡Œå³å¯kubectl create clusterrolebinding kubelet-bootstrap \ --clusterrole=system:node-bootstrapper \ --user=kubelet-bootstrap åˆ›å»º kubelet çš„serviceé…ç½®æ–‡ä»¶/usr/lib/systemd/system/kubelet.service 123456789101112131415161718192021222324[Unit]Description=Kubernetes Kubelet ServerDocumentation=https://github.com/GoogleCloudPlatform/kubernetesAfter=docker.serviceRequires=docker.service[Service]WorkingDirectory=/var/lib/kubeletEnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/kubeletExecStart=/usr/local/bin/kubelet \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBELET_API_SERVER \ $KUBELET_ADDRESS \ $KUBELET_PORT \ $KUBELET_HOSTNAME \ $KUBE_ALLOW_PRIV \ $KUBELET_POD_INFRA_CONTAINER \ $KUBELET_ARGSRestart=on-failure[Install]WantedBy=multi-user.target åˆ›å»º kube-proxy çš„serviceé…ç½®æ–‡ä»¶/usr/lib/systemd/system/kube-proxy.service 123456789101112131415161718[Unit]Description=Kubernetes Kube-Proxy ServerDocumentation=https://github.com/GoogleCloudPlatform/kubernetesAfter=network.target[Service]EnvironmentFile=-/etc/kubernetes/configEnvironmentFile=-/etc/kubernetes/proxyExecStart=/usr/local/bin/kube-proxy \ $KUBE_LOGTOSTDERR \ $KUBE_LOG_LEVEL \ $KUBE_MASTER \ $KUBE_PROXY_ARGSRestart=on-failureLimitNOFILE=65536[Install]WantedBy=multi-user.target config é€šç”¨é…ç½® 12345678910111213141516171819202122#### kubernetes system config## The following values are used to configure various aspects of all# kubernetes services, including## kube-apiserver.service# kube-controller-manager.service# kube-scheduler.service# kubelet.service# kube-proxy.service# logging to stderr means we get it in the systemd journalKUBE_LOGTOSTDERR=&quot;--logtostderr=true&quot;# journal message level, 0 is debugKUBE_LOG_LEVEL=&quot;--v=2&quot;# Should this cluster be allowed to run privileged docker containersKUBE_ALLOW_PRIV=&quot;--allow-privileged=true&quot;# How the controller-manager, scheduler, and proxy find the apiserver# KUBE_MASTER=&quot;--master=http://127.0.0.1:8080&quot; kubelet é…ç½® 123456789101112131415161718192021222324252627#### kubernetes kubelet (minion) config# The address for the info server to serve on (set to 0.0.0.0 or &quot;&quot; for all interfaces)KUBELET_ADDRESS=&quot;--address=192.168.7.14&quot;# The port for the info server to serve on# KUBELET_PORT=&quot;--port=10250&quot;# You may leave this blank to use the actual hostnameKUBELET_HOSTNAME=&quot;--hostname-override=docker4.node&quot;# location of the api-server#KUBELET_API_SERVER=&quot;--api-servers=http://192.168.7.11:8080&quot;# Add your own!KUBELET_ARGS=&quot;--cgroup-driver=cgroupfs \ --cluster-dns=10.254.0.2 \ --resolv-conf=/etc/resolv.conf \ --experimental-bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \ --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \ --require-kubeconfig \ --cert-dir=/etc/kubernetes/ssl \ --cluster-domain=cluster.local \ --hairpin-mode promiscuous-bridge \ --serialize-image-pulls=false \ --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.0&quot; proxy é…ç½® 12345678910#### kubernetes proxy config# default config should be adequate# Add your own!KUBE_PROXY_ARGS=&quot;--bind-address=192.168.7.14 \ --hostname-override=docker4.node \ --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig \ --cluster-cidr=10.254.0.0/16&quot; åˆ›å»º nginx ä»£ç†æ ¹æ®ä¸Šé¢æè¿°çš„ master HA æž¶æž„ï¼Œæ­¤æ—¶æ‰€æœ‰ node åº”è¯¥è¿žæŽ¥æœ¬åœ°çš„ nginx ä»£ç†ï¼Œç„¶åŽ nginx æ¥è´Ÿè½½æ‰€æœ‰ api serverï¼›ä»¥ä¸‹ä¸º nginx ä»£ç†ç›¸å…³é…ç½® 123456789101112131415161718192021222324252627282930313233# åˆ›å»ºé…ç½®ç›®å½•mkdir -p /etc/nginx# å†™å…¥ä»£ç†é…ç½®cat &lt;&lt; EOF &gt;&gt; /etc/nginx/nginx.conferror_log stderr notice;worker_processes auto;events &#123; multi_accept on; use epoll; worker_connections 1024;&#125;stream &#123; upstream kube_apiserver &#123; least_conn; server 192.168.7.11:6443; server 192.168.7.12:6443; server 192.168.7.13:6443; &#125; server &#123; listen 0.0.0.0:6443; proxy_pass kube_apiserver; proxy_timeout 10m; proxy_connect_timeout 1s; &#125;&#125;EOF# æ›´æ–°æƒé™chmod +r /etc/nginx/nginx.conf ä¸ºäº†ä¿è¯ nginx çš„å¯é æ€§ï¼Œç»¼åˆä¾¿æ·æ€§è€ƒè™‘ï¼Œnode èŠ‚ç‚¹ä¸Šçš„ nginx ä½¿ç”¨ docker å¯åŠ¨ï¼ŒåŒæ—¶ ä½¿ç”¨ systemd æ¥å®ˆæŠ¤ï¼Œ systemd é…ç½®å¦‚ä¸‹ 12345678910111213141516171819202122232425cat &lt;&lt; EOF &gt;&gt; /etc/systemd/system/nginx-proxy.service[Unit]Description=kubernetes apiserver docker wrapperWants=docker.socketAfter=docker.service[Service]User=rootPermissionsStartOnly=trueExecStart=/usr/bin/docker run -p 127.0.0.1:6443:6443 \\ -v /etc/nginx:/etc/nginx \\ --name nginx-proxy \\ --net=host \\ --restart=on-failure:5 \\ --memory=512M \\ nginx:1.13.3-alpineExecStartPre=-/usr/bin/docker rm -f nginx-proxyExecStop=/usr/bin/docker stop nginx-proxyRestart=alwaysRestartSec=15sTimeoutStartSec=30s[Install]WantedBy=multi-user.targetEOF å¯åŠ¨ kubeletã€nginx-proxy1234567systemctl daemon-reloadsystemctl start kubeletsystemctl enable kubeletsystemctl start kube-proxysystemctl enable kube-proxysystemctl start nginx-proxysystemctl enable nginx-proxy master èŠ‚ç‚¹éªŒè¯è¿žé€šæ€§1kubectl --server https://192.168.7.11:6443 --certificate-authority /etc/kubernetes/ssl/k8s-root-ca.pem --client-certificate /etc/kubernetes/ssl/admin.pem --client-key /etc/kubernetes/ssl/admin-key.pem get cs 12345678910111213# æŸ¥çœ‹ csrâžœ kubectl get csrNAME AGE REQUESTOR CONDITIONnode-csr-PhOGHB8BpFuNoYtnCGka4NTaxtDQDRjrctZtdaVsijY 2m kubelet-bootstrap Pending# ç­¾å‘è¯ä¹¦âžœ kubectl certificate approve node-csr-PhOGHB8BpFuNoYtnCGka4NTaxtDQDRjrctZtdaVsijYcertificatesigningrequest &quot;node-csr-PhOGHB8BpFuNoYtnCGka4NTaxtDQDRjrctZtdaVsijY&quot; approved# æŸ¥çœ‹ nodeâžœ kubectl get nodeNAME STATUS AGE VERSIONdocker4.node Ready 20s v1.7.4 å®‰è£… kubedns æ’ä»¶å®‰è£… dashboard æ’ä»¶å®‰è£… heapster æ’ä»¶å®‰è£… EFK æ’ä»¶éƒ¨ç½² harbor ç§æœ‰ä»“åº“]]></content>
      <categories>
        <category>devops</category>
        <category>kubernetes</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æ‚Ÿé€è‡ªå·±]]></title>
    <url>%2F2017%2F09%2F09%2F%E6%82%9F%E9%80%8F%E8%87%AA%E5%B7%B1%2F</url>
    <content type="text"><![CDATA[&emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;äººç”Ÿåœ¨ä¸–,å’Œâ€œè‡ªå·±â€ç›¸å¤„æœ€å¤š, ä½†æ˜¯å¾€å¾€æ‚Ÿä¸é€â€œè‡ªå·±â€. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;äººç”Ÿèµ°ä¸Šå¡è·¯æ—¶,å¾€å¾€æŠŠè‡ªå·±ä¼°è®¡è¿‡é«˜,ä¼¼ä¹Žä¸€åˆ‡æ‰€æ±‚çš„ä¸œè¥¿éƒ½èƒ½å”¾æ‰‹å¯å¾—,ç”šè‡³æŠŠè¿æ°”å’Œæœºé‡ä¹Ÿçœ‹ä½œè‡ªå·±èº«ä»·çš„ä¸€éƒ¨åˆ†è€Œå–œä¸è‡ªèƒœ.äººåœ¨ä¸å¾—æ„æ—¶,åˆå¾€å¾€æŠŠè‡ªå·±ä¼°è®¡è¿‡ä½Ž,æŠŠå›°éš¾å’Œä¸åˆ©ä¹Ÿçœ‹åšè‡ªå·±çš„æ— èƒ½,ä»¥è‡³äºŽæŠŠå®‰åˆ†å®ˆå·±,ä¸Žä¸–æ— äº‰è¯¯è®¤ä¸ºæœ‰è‡ªçŸ¥ä¹‹æ˜Ž,è€Œå®žé™…ä¸Šå¾€å¾€è¢«æ€¯æ‡¦çš„é¢å…·çª’æ¯äº†è‡ªå·±é²œæ´»çš„ç”Ÿå‘½. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‚Ÿé€è‡ªå·±,å°±æ˜¯æ­£ç¡®è®¤è¯†è‡ªå·±,ä¹Ÿå°±æ˜¯è¯´è¦åšä¸€ä¸ªå†·é™çš„çŽ°å®žä¸»ä¹‰è€…,æ—¢çŸ¥é“è‡ªå·±çš„ä¼˜åŠ¿,ä¹ŸçŸ¥é“è‡ªå·±çš„ä¸è¶³.æˆ‘ä»¬å¯ä»¥æ†§æ†¬äººç”Ÿ,ä½†æœŸæœ›å€¼ä¸èƒ½è¿‡é«˜.å› ä¸ºåœ¨çŽ°å®žä¸­,ç†æƒ³æ€»æ˜¯ä¼šæ‰“æŠ˜æ‰£çš„.å¯ä»¥è¿ŽæŽ¥æŒ‘æˆ˜.ä½†æ˜¯å¿…é¡»æ¸…æ¥šè‡ªå·±åŠªåŠ›çš„æ–¹å‘.ä¹Ÿå°±æ˜¯è¯´,äººä¸€æ—¦æœ‰äº†è‡ªçŸ¥ä¹‹æ˜Ž,ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆå…‹æœä¸äº†çš„å›°éš¾,æ²¡æœ‰ä»€ä¹ˆè¿‡ä¸åŽ»çš„éš¾å…³. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;è¦æ‚Ÿé€è‡ªå·±å°±è¦æ¬£èµè‡ªå·±.æ— è®ºä½ æ˜¯ä¸€æ£µå‚å¤©å¤§æ ‘,è¿˜æ˜¯ä¸€æ£µå°è‰,æ— è®ºä½ æˆä¸ºä¸€åº§å·å³¨çš„é«˜å±±,è¿˜æ˜¯ä¸€å¿«å°å°çš„çŸ³å¤´,éƒ½æ˜¯ä¸€ç§å¤©ç„¶,éƒ½æœ‰è‡ªå·±å­˜åœ¨çš„ä»·å€¼.åªè¦ä½ è®¤çœŸçš„æ¬£èµè‡ªå·±,ä½ å°±ä¼šæ‹¥æœ‰ä¸€ä¸ªçœŸæ­£çš„è‡ªæˆ‘.åªæœ‰è‡ªæˆ‘æ¬£èµæ‰ä¼šæœ‰ä¿¡å¿ƒ,ä¸€æ—¦æ‹¥æœ‰äº†ä¿¡å¿ƒä¹Ÿå°±ä¼šæ‹¥æœ‰äº†æŠµå¾¡ä¸€åˆ‡é€†å¢ƒçš„åŠ¨åŠ›. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;è¦æ‚Ÿé€è‡ªå·±,å°±è¦å¿ƒç–¼è‡ªå·±.åœ¨æ°”æ„¤æ—¶å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,æ‰¾ä¸ªåƒ»é™å¤„æ•£æ•£å¿ƒ,å®£æ³„å®£æ³„,ä¸è¦è®©é‚£äº›æ— åä¹‹ç«ä¼¤èº«;å¿§éƒæ—¶,è¦å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,æ‰¾ä¸‰äº”å¥½å‹,è¯‰è¯´è¯‰è¯´,è®©æ„Ÿæƒ…çš„é˜´å¤©å˜æ™´;åŠ³ç´¯æ—¶,ä½ è¦å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,ä¸ºè‡ªå·±æ¥ä¸€ç•ªé—®å¯’é—®æš–,è¦æ˜Žç™½äººæ‰€æ‹¥æœ‰çš„ä¸è¿‡æ˜¯ä¸€ä¸ªè¡€è‚‰ä¹‹èº¯,ç»ä¸ä½å¤ªå¤šçš„é£ŽåŠ›éœœå‰‘;æœ‰ç—…æ—¶,ä½ è¦å¿ƒç–¼ä¸€ä¸‹è‡ªå·±,æƒŸæœ‰å¯¹è‡ªå·±çš„å¿ƒç–¼,æ‰æ˜¯æˆ˜èƒœç–¾ç—…çš„ä¿¡å¿ƒå’ŒåŠ›é‡. &emsp;&emsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‚Ÿé€äº†è‡ªå·±,æ‰èƒ½æŠŠæ¡ä½è‡ªå·±,ä½ ç”Ÿæ´»æ‰ä¼šæœ‰æ»‹æœ‰å‘³!]]></content>
      <categories>
        <category>ESSAYS</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[JDKå®‰è£…é…ç½®]]></title>
    <url>%2F2017%2F09%2F08%2FJDK%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[ubuntu1ã€è§£åŽ‹æ–‡ä»¶å¹¶ä¿®æ”¹æ–‡ä»¶å 1sudo tar zxvf jdk-7u21-linux-i586.tar.gz -C /usr/lib/ è¿›å…¥åˆ°å®‰è£…ç›®å½•ä¸­ 1cd /usr/lib/ ä¿®æ”¹æ–‡ä»¶å 1sudo mv jdk1.7.0_21 java 2ã€æ·»åŠ çŽ¯å¢ƒå˜é‡ä½¿ç”¨vim ~/.bashrcå‘½ä»¤ç¼–è¾‘ 1234export JAVA_HOME=/usr/lib/javaexport JRE_HOME=$&#123;JAVA_HOME&#125;/jreexport CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/libexport PATH=$&#123;JAVA_HOME&#125;/bin:$PATH 3ã€æ¿€æ´»çŽ¯å¢ƒå˜é‡ 1source ~/.bashrc centos1ã€æŸ¥çœ‹JDKä¿¡æ¯ 1rpm -qa | grep java 2ã€å¸è½½OpenJDKâ€”â€”åœ¨ æ­¥éª¤ 1ä¸­ å¤åˆ¶æ‰€æœ‰çš„ openjdkå¸è½½ 1rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.71-2.5.3.1.el7_0.x86_64 3ã€å®‰è£…jdk 1sudo tar -zxvf yourjdk.tar.gz -C /usr/lib 4ã€é…ç½®JDKçŽ¯å¢ƒå˜é‡ 1234export JAVA_HOME=/usr/lib/jdk1.8.0_92export JRE_HOME=$&#123;JAVA_HOME&#125;/jreexport PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/binexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib 5ã€ä¸ºäº†ä½¿ç¼–è¯‘ç”Ÿæ•ˆ 1source /etc/profile 6ã€æŸ¥çœ‹pathå€¼ 1echo $PATH Macå®˜ç½‘ä¸‹è½½dmgç‰ˆæœ¬å®‰è£…åŽé…ç½®çŽ¯å¢ƒå¦‚ä¸‹ 1sudo vim ~/.bash_profile]]></content>
      <categories>
        <category>JAVA</category>
        <category>config</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2017%2F09%2F07%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
</search>
